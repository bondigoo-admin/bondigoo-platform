[NotificationItemContent.handleActionWithState] Opening BDM for PAY_NOW with this existingBooking prop: {"notificationId":"6914b9a517e678434634cbd9","bookingIdForModal":"6914b99017e678434634beb7","bookingDataPropForModal":{"payment":{"status":"pending","refunds":[],"reminderSent":[]},"sessionLink":{"token":"1a7b9474f568e0164706c615989b1cda5a5ea0de29564840582abe2966f8ebd4","sessionId":"33d7ec171acb6ba749a54f51113921cf7b509868b07a38e06e3be6ea5d669485","generatedAt":"2025-11-12T16:45:04.545Z","expired":false},"_id":"6914b99017e678434634beb7","coach":{"_id":"66d9cdcb0a7492a86482bd68","firstName":"Dominic","lastName":"Frei","email":"test.coach2@example.com"},"user":{"_id":"66f418d10a19ec0e4bbd377e","firstName":"Test","lastName":"User 2","email":"test.user2@example.com","profilePicture":{"publicId":"profile_picture_jgl5ga","url":"https://res.cloudinary.com/dzpjkn8eo/image/upload/v1753703993/profile_picture_jgl5ga.jpg"}},"userIds":[],"isLiveSession":false,"sessionType":"66ec4ea477bec414bf2b8859","start":"2025-11-13T06:00:00.000Z","end":"2025-11-13T06:45:00.000Z","timezone":"Europe/Zurich","status":"confirmed","price":{"base":{"amount":{"amount":90,"currency":"CHF"},"currency":"CHF"},"final":{"amount":{"amount":90,"currency":"CHF"},"currency":"CHF"},"vat":{"rate":8.1,"amount":6.74,"included":true},"platformFee":{"amount":0,"percentage":15},"currency":"CHF","discounts":[]},"disputeTicket":null,"overtime":{"allowOvertime":true,"freeOvertimeDuration":6,"paidOvertimeDuration":45,"overtimeRate":20,"_id":"6914b99017e678434634beb8","id":"6914b99017e678434634beb8"},"isAvailability":false,"availableForInstantBooking":true,"firmBookingThreshold":24,"title":"Einzel","description":"","location":"","isOnline":false,"language":null,"tags":[],"cancellationPolicy":{"oneOnOne":{"tiers":[{"hoursBefore":72,"refundPercentage":100},{"hoursBefore":24,"refundPercentage":50}],"minimumNoticeHoursClientCancellation":24,"additionalNotes":"Policy migrated from previous numeric setting.","rescheduling":{"allowClientInitiatedRescheduleHoursBefore":48,"clientRescheduleApprovalMode":"coach_approval_if_late"}},"webinar":{"tiers":[{"hoursBefore":72,"refundPercentage":100},{"hoursBefore":24,"refundPercentage":50}],"minimumNoticeHoursClientCancellation":24,"additionalNotes":"Default webinar policy."},"lastUpdated":"2025-10-20T06:23:53.529Z","policyPreset":"custom"},"sessionGoal":null,"clientNotes":null,"preparationRequired":null,"followUpTasks":null,"minAttendees":null,"maxAttendees":null,"sessionTopic":null,"prerequisites":null,"learningObjectives":null,"materialsProvided":null,"whatToBring":null,"skillLevel":null,"webinarSlots":[],"isPublic":true,"showInWebinarBrowser":true,"recurringPattern":"none","recurringEndDate":null,"earlyBirdDeadline":null,"earlyBirdPrice":null,"isPartOfPackage":false,"certificationOffered":false,"certificationDetails":null,"bookingType":"request","reminderSent":[],"sessionImages":[],"courseMaterials":[],"metadata":{"originalAvailability":"6914b98717e678434634be39","availabilitySettings":{"availableForInstantBooking":true,"firmBookingThreshold":24,"recurringPattern":"none"}},"attendees":[],"suggestedTimes":[],"waitlist":[],"reminders":[],"rescheduleHistory":[],"rescheduleRequests":[],"createdAt":"2025-11-12T16:45:04.495Z","updatedAt":"2025-11-12T16:45:24.900Z","__v":0,"recordings":{},"duration":45,"spotsRemaining":null,"id":"6914b99017e678434634beb7"},"modalInitialAction":"pay_now","timestamp":"2025-11-12T16:47:37.677Z"}
bundle.js:172424 [DEBUG] [BDM Render] BookingDetailsModal rendering. Count: 1. Reason: Initial Render
bundle.js:172424 [DEBUG] [BDM isClientOfBooking Check] {"isClient":true,"loggedInUserId":"66f418d10a19ec0e4bbd377e","derivedBookingUserId":"66f418d10a19ec0e4bbd377e","bookingUserRefAtStart":{"_id":"66f418d10a19ec0e4bbd377e","firstName":"Test","lastName":"User 2","email":"test.user2@example.com","profilePicture":{"publicId":"profile_picture_jgl5ga","url":"https://res.cloudinary.com/dzpjkn8eo/image/upload/v1753703993/profile_picture_jgl5ga.jpg"}},"isWebinarTypeCheck":false,"attendeesCount":0}
bundle.js:172414  [applicablePriceInfo] Bailing early: No currentDisplayBooking or not a webinar type. {"isWebinarType":false,"hasCurrentDisplayBooking":true} Error Component Stack
    at BookingDetailsModal (src_components_BookingDetailsModal_js.chunk.js:660:3)
    at NotificationItemContent (src_components_NotificationItemContent_js.chunk.js:199:3)
    at div (<anonymous>)
    at MotionComponent (bundle.js:44553:59)
    at NotificationItem (src_components_NotificationCenter_js-src_services_ReviewAPI_js-node_modules_lucide-react_dist-f2e835.chunk.js:954:3)
    at ErrorBoundary (src_components_BookingDetailsModal_js.chunk.js:5423:5)
    at div (<anonymous>)
    at div (<anonymous>)
    at _c9 (bundle.js:146045:3)
    at div (<anonymous>)
    at _c (bundle.js:145989:3)
    at NotificationCenterInner (src_components_NotificationCenter_js-src_services_ReviewAPI_js-node_modules_lucide-react_dist-f2e835.chunk.js:480:3)
    at SocketProvider (bundle.js:149933:3)
    at NotificationCenter (src_components_NotificationCenter_js-src_services_ReviewAPI_js-node_modules_lucide-react_dist-f2e835.chunk.js:859:3)
    at RenderedRoute (bundle.js:118201:5)
    at Outlet (bundle.js:118848:26)
    at ProtectedRoute (src_components_ProtectedRoute_js.chunk.js:119:69)
    at RenderedRoute (bundle.js:118201:5)
    at Routes (bundle.js:118935:5)
    at Suspense (<anonymous>)
    at main (<anonymous>)
    at div (<anonymous>)
    at AppContent (bundle.js:137964:69)
    at LiveSessionProvider (bundle.js:149011:3)
    at NotificationSocketProvider (bundle.js:149838:3)
    at AppWithSocketProvider (bundle.js:138900:69)
    at AppWithSocketProviderWrapper (bundle.js:138983:69)
    at AuthProvider (bundle.js:148641:3)
    at PaymentProvider (bundle.js:149626:3)
    at Elements (bundle.js:15340:30)
    at Suspense (<anonymous>)
    at App (bundle.js:138935:51)
    at AuthProvider (bundle.js:148641:3)
    at QueryClientProvider (bundle.js:114104:21)
    at Router (bundle.js:118869:15)
    at BrowserRouter (bundle.js:116769:5)
overrideMethod @ hook.js:608
warn @ bundle.js:172414
(anonymous) @ src_components_BookingDetailsModal_js.chunk.js:1330
mountMemo @ bundle.js:97421
useMemo @ bundle.js:97806
useMemo @ bundle.js:123096
BookingDetailsModal @ src_components_BookingDetailsModal_js.chunk.js:1327
renderWithHooks @ bundle.js:96649
mountIndeterminateComponent @ bundle.js:100621
beginWork @ bundle.js:101924
beginWork$1 @ bundle.js:106883
performUnitOfWork @ bundle.js:106153
workLoopSync @ bundle.js:106076
renderRootSync @ bundle.js:106049
performSyncWorkOnRoot @ bundle.js:105741
flushSyncCallbacks @ bundle.js:93742
(anonymous) @ bundle.js:105373
bundle.js:172424 [DEBUG] [BDM canClientCancelThisBooking] Evaluating eligibility. {"isClientOfBookingResult":true,"hasCurrentDisplayBooking":true,"hasUser":true,"bookingStatus":"confirmed"}
bundle.js:172424 [DEBUG] [BDM canClientCancelThisBooking] Conditions met. Client can cancel this booking. {"bookingId":"6914b99017e678434634beb7"}
bundle.js:54858 i18next::translator: missingKey de bookings bookingDetailsDescription View details and manage your booking.
bundle.js:83255  Warning: BookingDetailsModal: Support for defaultProps will be removed from function components in a future major release. Use JavaScript default parameters instead. Error Component Stack
    at BookingDetailsModal (src_components_BookingDetailsModal_js.chunk.js:660:3)
    at NotificationItemContent (src_components_NotificationItemContent_js.chunk.js:199:3)
    at div (<anonymous>)
    at MotionComponent (bundle.js:44553:59)
    at NotificationItem (src_components_NotificationCenter_js-src_services_ReviewAPI_js-node_modules_lucide-react_dist-f2e835.chunk.js:954:3)
    at ErrorBoundary (src_components_BookingDetailsModal_js.chunk.js:5423:5)
    at div (<anonymous>)
    at div (<anonymous>)
    at _c9 (bundle.js:146045:3)
    at div (<anonymous>)
    at _c (bundle.js:145989:3)
    at NotificationCenterInner (src_components_NotificationCenter_js-src_services_ReviewAPI_js-node_modules_lucide-react_dist-f2e835.chunk.js:480:3)
    at SocketProvider (bundle.js:149933:3)
    at NotificationCenter (src_components_NotificationCenter_js-src_services_ReviewAPI_js-node_modules_lucide-react_dist-f2e835.chunk.js:859:3)
    at RenderedRoute (bundle.js:118201:5)
    at Outlet (bundle.js:118848:26)
    at ProtectedRoute (src_components_ProtectedRoute_js.chunk.js:119:69)
    at RenderedRoute (bundle.js:118201:5)
    at Routes (bundle.js:118935:5)
    at Suspense (<anonymous>)
    at main (<anonymous>)
    at div (<anonymous>)
    at AppContent (bundle.js:137964:69)
    at LiveSessionProvider (bundle.js:149011:3)
    at NotificationSocketProvider (bundle.js:149838:3)
    at AppWithSocketProvider (bundle.js:138900:69)
    at AppWithSocketProviderWrapper (bundle.js:138983:69)
    at AuthProvider (bundle.js:148641:3)
    at PaymentProvider (bundle.js:149626:3)
    at Elements (bundle.js:15340:30)
    at Suspense (<anonymous>)
    at App (bundle.js:138935:51)
    at AuthProvider (bundle.js:148641:3)
    at QueryClientProvider (bundle.js:114104:21)
    at Router (bundle.js:118869:15)
    at BrowserRouter (bundle.js:116769:5)
overrideMethod @ hook.js:608
printWarning @ bundle.js:83255
error @ bundle.js:83232
validateFunctionComponentInDev @ bundle.js:100722
mountIndeterminateComponent @ bundle.js:100691
beginWork @ bundle.js:101924
beginWork$1 @ bundle.js:106883
performUnitOfWork @ bundle.js:106153
workLoopSync @ bundle.js:106076
renderRootSync @ bundle.js:106049
performSyncWorkOnRoot @ bundle.js:105741
flushSyncCallbacks @ bundle.js:93742
(anonymous) @ bundle.js:105373
bundle.js:172419 [BookingDetailsModal] Mounted. Checking for onSave prop. {"bookingId":"6914b99017e678434634beb7","hasOnSave":false,"source":"notification"}
bundle.js:172424 [DEBUG] [BDM Perf] publicBookingSummary object reference changed.
bundle.js:172424 [DEBUG] [BDM Perf] fetchedBookingDocument object reference changed.
bundle.js:172424 [DEBUG] [BDM Perf] bookingData object reference changed.
bundle.js:172419 [sessionAPI] Fetching session recordings {"bookingId":"6914b99017e678434634beb7"}
bundle.js:172414  [BookingDetailsModal] Dialog overlay not found for pointer events toggle {"bookingId":"6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:37.722Z"} Error Component Stack
    at BookingDetailsModal (src_components_BookingDetailsModal_js.chunk.js:660:3)
    at NotificationItemContent (src_components_NotificationItemContent_js.chunk.js:199:3)
    at div (<anonymous>)
    at MotionComponent (bundle.js:44553:59)
    at NotificationItem (src_components_NotificationCenter_js-src_services_ReviewAPI_js-node_modules_lucide-react_dist-f2e835.chunk.js:954:3)
    at ErrorBoundary (src_components_BookingDetailsModal_js.chunk.js:5423:5)
    at div (<anonymous>)
    at div (<anonymous>)
    at _c9 (bundle.js:146045:3)
    at div (<anonymous>)
    at _c (bundle.js:145989:3)
    at NotificationCenterInner (src_components_NotificationCenter_js-src_services_ReviewAPI_js-node_modules_lucide-react_dist-f2e835.chunk.js:480:3)
    at SocketProvider (bundle.js:149933:3)
    at NotificationCenter (src_components_NotificationCenter_js-src_services_ReviewAPI_js-node_modules_lucide-react_dist-f2e835.chunk.js:859:3)
    at RenderedRoute (bundle.js:118201:5)
    at Outlet (bundle.js:118848:26)
    at ProtectedRoute (src_components_ProtectedRoute_js.chunk.js:119:69)
    at RenderedRoute (bundle.js:118201:5)
    at Routes (bundle.js:118935:5)
    at Suspense (<anonymous>)
    at main (<anonymous>)
    at div (<anonymous>)
    at AppContent (bundle.js:137964:69)
    at LiveSessionProvider (bundle.js:149011:3)
    at NotificationSocketProvider (bundle.js:149838:3)
    at AppWithSocketProvider (bundle.js:138900:69)
    at AppWithSocketProviderWrapper (bundle.js:138983:69)
    at AuthProvider (bundle.js:148641:3)
    at PaymentProvider (bundle.js:149626:3)
    at Elements (bundle.js:15340:30)
    at Suspense (<anonymous>)
    at App (bundle.js:138935:51)
    at AuthProvider (bundle.js:148641:3)
    at QueryClientProvider (bundle.js:114104:21)
    at Router (bundle.js:118869:15)
    at BrowserRouter (bundle.js:116769:5)
overrideMethod @ hook.js:608
warn @ bundle.js:172414
(anonymous) @ src_components_BookingDetailsModal_js.chunk.js:1591
commitHookEffectListMount @ bundle.js:103236
commitPassiveMountOnFiber @ bundle.js:104729
commitPassiveMountEffects_complete @ bundle.js:104701
commitPassiveMountEffects_begin @ bundle.js:104691
commitPassiveMountEffects @ bundle.js:104681
flushPassiveEffectsImpl @ bundle.js:106564
flushPassiveEffects @ bundle.js:106517
commitRootImpl @ bundle.js:106476
commitRoot @ bundle.js:106259
performSyncWorkOnRoot @ bundle.js:105768
flushSyncCallbacks @ bundle.js:93742
(anonymous) @ bundle.js:105373
bundle.js:172419 [BookingDetailsModal] No clientSecret found on booking. Creating new PaymentIntent. {"bookingId":"6914b99017e678434634beb7"}
bundle.js:172419 [PaymentOrchestrator] Registering cleanup: {"flowId":"6914b99017e678434634beb7","cleanupId":"cleanup-6914b99017e678434634beb7-1762966057735","existingCleanups":[],"metadata":{"source":"booking_details_modal","reason":"component_unmount","preserveState":false,"force":false,"metadata":{}},"timestamp":"2025-11-12T16:47:37.735Z"}
bundle.js:172419 [PaymentOrchestrator] Handling cleanup request: {"flowId":"6914b99017e678434634beb7","cleanupId":"cleanup-6914b99017e678434634beb7-1762966057735","source":"booking_details_modal","reason":"component_unmount","preserveState":false,"force":false,"timestamp":"2025-11-12T16:47:37.735Z"}
bundle.js:172419 [PaymentOrchestrator] Checking cleanup permission: {"flowId":"6914b99017e678434634beb7","source":"booking_details_modal","timestamp":"2025-11-12T16:47:37.736Z"}
bundle.js:172419 [PaymentOrchestrator] Publishing cleanup state update: {"flowId":"6914b99017e678434634beb7","cleanupId":"cleanup-6914b99017e678434634beb7-1762966057735","timestamp":"2025-11-12T16:47:37.736Z"}
bundle.js:172414  [PaymentStatusService] Attempted to publish before state ready: {"flowId":"6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:37.736Z"}
overrideMethod @ hook.js:608
warn @ bundle.js:172414
_publishStateUpdate @ bundle.js:163864
handleCleanup @ bundle.js:157654
(anonymous) @ src_components_BookingDetailsModal_js.chunk.js:1543
safelyCallDestroy @ bundle.js:103057
commitHookEffectListUnmount @ bundle.js:103195
invokePassiveEffectUnmountInDEV @ bundle.js:104971
invokeEffectsInDev @ bundle.js:106822
commitDoubleInvokeEffectsInDEV @ bundle.js:106801
flushPassiveEffectsImpl @ bundle.js:106578
flushPassiveEffects @ bundle.js:106517
commitRootImpl @ bundle.js:106476
commitRoot @ bundle.js:106259
performSyncWorkOnRoot @ bundle.js:105768
flushSyncCallbacks @ bundle.js:93742
(anonymous) @ bundle.js:105373
bundle.js:4666  Warning: Missing `Description` or `aria-describedby={undefined}` for {DialogContent}. Error Component Stack
    at DescriptionWarning (bundle.js:4657:3)
    at bundle.js:4549:5
    at bundle.js:4487:56
    at Presence (bundle.js:5084:5)
    at bundle.js:4468:62
    at div (<anonymous>)
    at bundle.js:8543:7
    at bundle.js:8508:7
    at bundle.js:8208:7
    at bundle.js:8002:16
    at Presence (bundle.js:5084:5)
    at Provider (bundle.js:4207:9)
    at DialogPortal (bundle.js:4402:5)
    at DialogPortal (bundle.js:146491:3)
    at bundle.js:146527:3
    at Provider (bundle.js:4207:9)
    at Dialog (bundle.js:4346:5)
    at BookingDetailsModal (src_components_BookingDetailsModal_js.chunk.js:660:3)
    at NotificationItemContent (src_components_NotificationItemContent_js.chunk.js:199:3)
    at div (<anonymous>)
    at MotionComponent (bundle.js:44553:59)
    at NotificationItem (src_components_NotificationCenter_js-src_services_ReviewAPI_js-node_modules_lucide-react_dist-f2e835.chunk.js:954:3)
    at ErrorBoundary (src_components_BookingDetailsModal_js.chunk.js:5423:5)
    at div (<anonymous>)
    at div (<anonymous>)
    at _c9 (bundle.js:146045:3)
    at div (<anonymous>)
    at _c (bundle.js:145989:3)
    at NotificationCenterInner (src_components_NotificationCenter_js-src_services_ReviewAPI_js-node_modules_lucide-react_dist-f2e835.chunk.js:480:3)
    at SocketProvider (bundle.js:149933:3)
    at NotificationCenter (src_components_NotificationCenter_js-src_services_ReviewAPI_js-node_modules_lucide-react_dist-f2e835.chunk.js:859:3)
    at RenderedRoute (bundle.js:118201:5)
    at Outlet (bundle.js:118848:26)
    at ProtectedRoute (src_components_ProtectedRoute_js.chunk.js:119:69)
    at RenderedRoute (bundle.js:118201:5)
    at Routes (bundle.js:118935:5)
    at Suspense (<anonymous>)
    at main (<anonymous>)
    at div (<anonymous>)
    at AppContent (bundle.js:137964:69)
    at LiveSessionProvider (bundle.js:149011:3)
    at NotificationSocketProvider (bundle.js:149838:3)
    at AppWithSocketProvider (bundle.js:138900:69)
    at AppWithSocketProviderWrapper (bundle.js:138983:69)
    at AuthProvider (bundle.js:148641:3)
    at PaymentProvider (bundle.js:149626:3)
    at Elements (bundle.js:15340:30)
    at Suspense (<anonymous>)
    at App (bundle.js:138935:51)
    at AuthProvider (bundle.js:148641:3)
    at QueryClientProvider (bundle.js:114104:21)
    at Router (bundle.js:118869:15)
    at BrowserRouter (bundle.js:116769:5)
overrideMethod @ hook.js:608
(anonymous) @ bundle.js:4666
commitHookEffectListMount @ bundle.js:103236
commitPassiveMountOnFiber @ bundle.js:104729
commitPassiveMountEffects_complete @ bundle.js:104701
commitPassiveMountEffects_begin @ bundle.js:104691
commitPassiveMountEffects @ bundle.js:104681
flushPassiveEffectsImpl @ bundle.js:106564
flushPassiveEffects @ bundle.js:106517
commitRootImpl @ bundle.js:106476
commitRoot @ bundle.js:106259
performSyncWorkOnRoot @ bundle.js:105768
flushSyncCallbacks @ bundle.js:93742
(anonymous) @ bundle.js:105373
bundle.js:4666  Warning: Missing `Description` or `aria-describedby={undefined}` for {DialogContent}.
overrideMethod @ hook.js:608
(anonymous) @ bundle.js:4666
commitHookEffectListMount @ bundle.js:103236
invokePassiveEffectMountInDEV @ bundle.js:104925
invokeEffectsInDev @ bundle.js:106822
commitDoubleInvokeEffectsInDEV @ bundle.js:106805
flushPassiveEffectsImpl @ bundle.js:106578
flushPassiveEffects @ bundle.js:106517
commitRootImpl @ bundle.js:106476
commitRoot @ bundle.js:106259
performSyncWorkOnRoot @ bundle.js:105768
flushSyncCallbacks @ bundle.js:93742
(anonymous) @ bundle.js:105373
bundle.js:172419 [PaymentAPI] Creating payment intent - configuration: {"bookingId":"6914b99017e678434634beb7","timeoutDuration":15000,"hasSocket":false,"timestamp":"2025-11-12T16:47:37.848Z"}
bundle.js:172414  [PaymentAPI] Socket not connected, attempting to reconnect {"bookingId":"6914b99017e678434634beb7"}
overrideMethod @ hook.js:608
warn @ bundle.js:172414
(anonymous) @ bundle.js:169256
(anonymous) @ bundle.js:168862
_ensureUniqueIntent @ bundle.js:168866
createPaymentIntent @ bundle.js:169254
(anonymous) @ src_components_BookingDetailsModal_js.chunk.js:2494
await in (anonymous)
(anonymous) @ src_components_BookingDetailsModal_js.chunk.js:2577
commitHookEffectListMount @ bundle.js:103236
commitPassiveMountOnFiber @ bundle.js:104729
commitPassiveMountEffects_complete @ bundle.js:104701
commitPassiveMountEffects_begin @ bundle.js:104691
commitPassiveMountEffects @ bundle.js:104681
flushPassiveEffectsImpl @ bundle.js:106564
flushPassiveEffects @ bundle.js:106517
commitRootImpl @ bundle.js:106476
commitRoot @ bundle.js:106259
performSyncWorkOnRoot @ bundle.js:105768
flushSyncCallbacks @ bundle.js:93742
(anonymous) @ bundle.js:105373
bundle.js:172424 [DEBUG] [BDM Render] BookingDetailsModal rendering. Count: 2. Reason: Internal state or context update
bundle.js:54858 i18next::translator: missingKey de bookings bookingDetailsDescription View details and manage your booking.
bundle.js:172419 [sessionAPI] Session recordings fetched successfully {"bookingId":"6914b99017e678434634beb7","recordingCount":0}
bundle.js:172419 [BookingDetailsModal] Session recordings loaded {"actualBookingId":"6914b99017e678434634beb7","recordingCount":0}
bundle.js:172424 [DEBUG] [MenuAnnouncementBadge] Render cancelled: No unseen announcements. {"totalFetched":0,"seenInSession":0}
bundle.js:172424 [DEBUG] [BDM Perf Debug] Prop changes detected: {"onClose":{"from":"ref A","to":"ref B","note":"Reference changed"},"onSuggest":{"from":"ref A","to":"ref B","note":"Reference changed"}}
bundle.js:172424 [DEBUG] [BDM Render] BookingDetailsModal rendering. Count: 4. Reason: Props changed: onClose, onSuggest
bundle.js:54858 i18next::translator: missingKey de bookings bookingDetailsDescription View details and manage your booking.
bundle.js:172424 [DEBUG] [BDM Render] BookingDetailsModal rendering. Count: 6. Reason: Internal state or context update
bundle.js:54858 i18next::translator: missingKey de bookings bookingDetailsDescription View details and manage your booking.
bundle.js:172419 [PaymentOrchestrator] No flow to cleanup: {"flowId":"6914b99017e678434634beb7","cleanupId":"cleanup-6914b99017e678434634beb7-1762966057735","timestamp":"2025-11-12T16:47:38.074Z"}
bundle.js:172419 [PaymentOrchestrator] Cleanup completed: {"flowId":"6914b99017e678434634beb7","cleanupId":"cleanup-6914b99017e678434634beb7-1762966057735","result":true,"timestamp":"2025-11-12T16:47:38.074Z"}
bundle.js:172424 [DEBUG] [BDM Render] BookingDetailsModal rendering. Count: 8. Reason: Internal state or context update
bundle.js:54858 i18next::translator: missingKey de bookings bookingDetailsDescription View details and manage your booking.
bundle.js:172414  [PaymentSocket] Connection health check failed: {"error":"Ping timeout","socketId":"smjVBwsVpVOzqHmPAAAX","timeoutMs":2000,"timestamp":"2025-11-12T16:47:40.099Z"}
overrideMethod @ hook.js:608
warn @ bundle.js:172414
_checkConnectionHealth @ bundle.js:161338
await in _checkConnectionHealth
(anonymous) @ bundle.js:160526
__webpack_modules__../node_modules/@socket.io/component-emitter/lib/esm/index.js.Emitter.emit @ bundle.js:14906
onconnect @ bundle.js:125826
onpacket @ bundle.js:125723
__webpack_modules__../node_modules/@socket.io/component-emitter/lib/esm/index.js.Emitter.emit @ bundle.js:14906
(anonymous) @ bundle.js:125060
Promise.then
(anonymous) @ bundle.js:36376
ondecoded @ bundle.js:125059
__webpack_modules__../node_modules/@socket.io/component-emitter/lib/esm/index.js.Emitter.emit @ bundle.js:14906
add @ bundle.js:126433
ondata @ bundle.js:125047
__webpack_modules__../node_modules/@socket.io/component-emitter/lib/esm/index.js.Emitter.emit @ bundle.js:14906
_onPacket @ bundle.js:36698
__webpack_modules__../node_modules/@socket.io/component-emitter/lib/esm/index.js.Emitter.emit @ bundle.js:14906
onPacket @ bundle.js:37257
onData @ bundle.js:37249
ws.onmessage @ bundle.js:37889
bundle.js:172419 [PaymentSocket] Connected successfully: {"socketId":"smjVBwsVpVOzqHmPAAAX","connectionId":"conn-1762966057849","attempt":1,"timestamp":"2025-11-12T16:47:40.100Z"}
bundle.js:172419 [PaymentAPI] Creating payment intent: {"bookingId":"6914b99017e678434634beb7","price":{"base":{"amount":{"amount":90,"currency":"CHF"},"currency":"CHF"},"final":{"amount":{"amount":90,"currency":"CHF"},"currency":"CHF"},"vat":{"rate":8.1,"amount":6.74,"included":true},"platformFee":{"amount":0,"percentage":15},"currency":"CHF","discounts":[]},"hasMetadata":true,"timestamp":"2025-11-12T16:47:40.101Z"}
bundle.js:172424 [DEBUG] [PaymentAPI] Attempting operation: {"attempt":1,"maxAttempts":3,"context":{},"timestamp":"2025-11-12T16:47:40.101Z"}
bundle.js:172424 [DEBUG] [PaymentAPI] Normalizing payment intent response: {"hasData":true,"responseKeys":["success","clientSecret","paymentIntent"],"timestamp":"2025-11-12T16:47:41.007Z"}
bundle.js:172419 [PaymentAPI] Successfully normalized payment intent response: {"paymentIntentId":"pi_3SShCoHKNqVBSHKU0rOFDQg0","amount":9000,"currency":"chf","timestamp":"2025-11-12T16:47:41.007Z"}
bundle.js:172419 [PaymentAPI] Payment intent created successfully: {"bookingId":"6914b99017e678434634beb7","paymentIntentId":"pi_3SShCoHKNqVBSHKU0rOFDQg0","hasClientSecret":true,"timestamp":"2025-11-12T16:47:41.008Z"}
bundle.js:169348 [PaymentAPI] Payment intent created: {bookingId: '6914b99017e678434634beb7', paymentIntentId: 'pi_3SShCoHKNqVBSHKU0rOFDQg0'}
bundle.js:172419 [PaymentAPI] Starting payment status monitoring: {"paymentIntentId":"pi_3SShCoHKNqVBSHKU0rOFDQg0","bookingId":"6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:41.008Z"}
bundle.js:172419 [PaymentAPI] Payment monitoring started: {"paymentIntentId":"pi_3SShCoHKNqVBSHKU0rOFDQg0","bookingId":"6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:41.008Z"}
bundle.js:172419 [PaymentOrchestrator] Flow ID creation details: {"bookingId":"6914b99017e678434634beb7","isPreConfirmation":false,"existingLock":false,"existingQueue":false,"timestamp":"2025-11-12T16:47:41.008Z"}
bundle.js:172419 [PaymentOrchestrator] Creating new flow: {"flowId":"6914b99017e678434634beb7","bookingId":"6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:41.008Z"}
bundle.js:172419 [PaymentOrchestrator] Starting initialization sequence: {"config":{"flowId":"6914b99017e678434634beb7","bookingId":"6914b99017e678434634beb7","amount":9000,"currency":"CHF","timing":{"id":"immediate","label":"Pay Now"},"metadata":{"bookingType":"unknown","sessionType":"unknown","duration":45,"priceStructure":{"base":{"amount":{"amount":90,"currency":"CHF"},"currency":"CHF"},"final":{"amount":{"amount":90,"currency":"CHF"},"currency":"CHF"},"vat":{"rate":8.1,"amount":6.74,"included":true},"platformFee":{"amount":0,"percentage":15},"currency":"CHF","discounts":[]},"confirmationId":"6914b99017e678434634beb7","preserveOnUnmount":true,"flowState":"post_booking","isPreBooking":false,"modalState":"payment_active","paymentStep":"method","clientSecret":"pi_3SShCoHKNqVBSHKU0rOFDQg0_secret_gZqQ01ts13sGokibVTauR1eIc"}},"existingFlows":["6914b99017e678434634beb7"],"timestamp":"2025-11-12T16:47:41.009Z"}
bundle.js:172419 [Orchestrator - LOG A] ==> Initializing flow. Received bookingId (stable ID): 6914b99017e678434634beb7, flowId (transient ID): 6914b99017e678434634beb7
bundle.js:172419 [PaymentOrchestrator] Using existing flow: {"flowId":"6914b99017e678434634beb7","status":"initializing","timestamp":"2025-11-12T16:47:41.009Z"}
bundle.js:172419 [PaymentOrchestrator] Ensuring flow state synchronization: {"flowId":"6914b99017e678434634beb7","bookingId":"6914b99017e678434634beb7","targetId":"6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:41.009Z"}
bundle.js:172419 [PaymentStatusService] State requested for unknown payment: {"bookingId":"6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:41.009Z"}
bundle.js:172419 [PaymentOrchestrator] Creating missing status state: {"targetId":"6914b99017e678434634beb7","flowId":"6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:41.009Z"}
bundle.js:172419 [PaymentStatusService] Initializing flow state: {"flowId":"6914b99017e678434634beb7","hasInitialState":true,"options":{},"timestamp":"2025-11-12T16:47:41.009Z"}
bundle.js:172419 [PaymentStatusService] Initialized paymentStates for flow {"flowId":"6914b99017e678434634beb7","state":{"status":"initializing","version":1,"createdAt":"2025-11-12T16:47:41.010Z","lastUpdated":"2025-11-12T16:47:41.010Z","updates":[],"metadata":{}},"timestamp":"2025-11-12T16:47:41.010Z"}
bundle.js:172419 [PaymentStatusService] Initialized flowStates for flow {"flowId":"6914b99017e678434634beb7","state":{"status":"initializing","version":1,"createdAt":"2025-11-12T16:47:41.010Z","lastUpdated":"2025-11-12T16:47:41.010Z","transitions":[]},"timestamp":"2025-11-12T16:47:41.010Z"}
bundle.js:172419 [PaymentStatusService] Initialized stateVersions for flow {"flowId":"6914b99017e678434634beb7","version":1,"timestamp":"2025-11-12T16:47:41.010Z"}
bundle.js:172419 [PaymentStatusService] State maps ensured {"flowId":"6914b99017e678434634beb7","mapSizes":{"paymentStates":1,"flowStates":1,"stateVersions":1},"paymentState":{"status":"initializing","version":1,"createdAt":"2025-11-12T16:47:41.010Z","lastUpdated":"2025-11-12T16:47:41.010Z","updates":[],"metadata":{}},"flowState":{"status":"initializing","version":1,"createdAt":"2025-11-12T16:47:41.010Z","lastUpdated":"2025-11-12T16:47:41.010Z","transitions":[]},"timestamp":"2025-11-12T16:47:41.010Z"}
bundle.js:172419 [PaymentStatusService] Flow state initialized: {"flowId":"6914b99017e678434634beb7","state":"initializing","timestamp":"2025-11-12T16:47:41.010Z"}
bundle.js:172419 [PaymentOrchestrator] Updating orchestrator state from status service: {"flowId":"6914b99017e678434634beb7","targetId":"6914b99017e678434634beb7","fromStatus":"initializing","toStatus":"initializing","timestamp":"2025-11-12T16:47:41.010Z"}
bundle.js:172419 [PaymentOrchestrator] Flow state synchronization completed: {"flowId":"6914b99017e678434634beb7","bookingId":"6914b99017e678434634beb7","status":"initializing","timestamp":"2025-11-12T16:47:41.010Z"}
bundle.js:172424 [DEBUG] [BDM Render] BookingDetailsModal rendering. Count: 10. Reason: Internal state or context update
bundle.js:54858 i18next::translator: missingKey de bookings bookingDetailsDescription View details and manage your booking.
bundle.js:119424  Warning: Failed prop type: The prop `onCancel` is marked as required in `PaymentPopup`, but its value is `undefined`.
    at PaymentPopup (http://localhost:3000/static/js/src_components_payment_PaymentPopup_js.chunk.js:42:3)
    at BookingDetailsModal (http://localhost:3000/static/js/src_components_BookingDetailsModal_js.chunk.js:660:3)
    at NotificationItemContent (http://localhost:3000/static/js/src_components_NotificationItemContent_js.chunk.js:199:3)
    at div
    at MotionComponent (http://localhost:3000/static/js/bundle.js:44553:59)
    at NotificationItem (http://localhost:3000/static/js/src_components_NotificationCenter_js-src_services_ReviewAPI_js-node_modules_lucide-react_dist-f2e835.chunk.js:954:3)
    at ErrorBoundary (http://localhost:3000/static/js/src_components_BookingDetailsModal_js.chunk.js:5423:5)
    at div
    at div
    at _c9 (http://localhost:3000/static/js/bundle.js:146045:3)
    at div
    at _c (http://localhost:3000/static/js/bundle.js:145989:3)
    at NotificationCenterInner (http://localhost:3000/static/js/src_components_NotificationCenter_js-src_services_ReviewAPI_js-node_modules_lucide-react_dist-f2e835.chunk.js:480:3)
    at SocketProvider (http://localhost:3000/static/js/bundle.js:149933:3)
    at NotificationCenter (http://localhost:3000/static/js/src_components_NotificationCenter_js-src_services_ReviewAPI_js-node_modules_lucide-react_dist-f2e835.chunk.js:859:3)
    at RenderedRoute (http://localhost:3000/static/js/bundle.js:118201:5)
    at Outlet (http://localhost:3000/static/js/bundle.js:118848:26)
    at ProtectedRoute (http://localhost:3000/static/js/src_components_ProtectedRoute_js.chunk.js:119:69)
    at RenderedRoute (http://localhost:3000/static/js/bundle.js:118201:5)
    at Routes (http://localhost:3000/static/js/bundle.js:118935:5)
    at Suspense
    at main
    at div
    at AppContent (http://localhost:3000/static/js/bundle.js:137964:69)
    at LiveSessionProvider (http://localhost:3000/static/js/bundle.js:149011:3)
    at NotificationSocketProvider (http://localhost:3000/static/js/bundle.js:149838:3)
    at AppWithSocketProvider (http://localhost:3000/static/js/bundle.js:138900:69)
    at AppWithSocketProviderWrapper (http://localhost:3000/static/js/bundle.js:138983:69)
    at AuthProvider (http://localhost:3000/static/js/bundle.js:148641:3)
    at PaymentProvider (http://localhost:3000/static/js/bundle.js:149626:3)
    at Elements (http://localhost:3000/static/js/bundle.js:15340:30)
    at Suspense
    at App (http://localhost:3000/static/js/bundle.js:138935:51)
    at AuthProvider (http://localhost:3000/static/js/bundle.js:148641:3)
    at QueryClientProvider (http://localhost:3000/static/js/bundle.js:114104:21)
    at Router (http://localhost:3000/static/js/bundle.js:118869:15)
    at BrowserRouter (http://localhost:3000/static/js/bundle.js:116769:5)
overrideMethod @ hook.js:608
printWarning @ bundle.js:119424
error @ bundle.js:119401
checkPropTypes @ bundle.js:119886
validatePropTypes @ bundle.js:120350
jsxWithValidation @ bundle.js:120463
BookingDetailsModal @ src_components_BookingDetailsModal_js.chunk.js:5235
renderWithHooks @ bundle.js:96649
updateFunctionComponent @ bundle.js:100217
beginWork @ bundle.js:101936
beginWork$1 @ bundle.js:106883
performUnitOfWork @ bundle.js:106153
workLoopSync @ bundle.js:106076
renderRootSync @ bundle.js:106049
performConcurrentWorkOnRoot @ bundle.js:105444
workLoop @ bundle.js:124361
flushWork @ bundle.js:124339
performWorkUntilDeadline @ bundle.js:124576
bundle.js:172419 [PaymentPopup] Component rendered {"bookingId":"6914b99017e678434634beb7","isOpen":true,"timestamp":"2025-11-12T16:47:41.033Z"}
bundle.js:172419 [PaymentPopup] Rendering with portal {"bookingId":"6914b99017e678434634beb7","isOpen":true,"portalContainerExists":true,"timestamp":"2025-11-12T16:47:41.033Z"}
bundle.js:172419 [PaymentOrchestrator] Checking flow protection: {"flowId":"6914b99017e678434634beb7","status":"initializing","isProtected":true,"timestamp":"2025-11-12T16:47:41.041Z"}
bundle.js:172419 [PaymentOrchestrator] Blocking cleanup - protected state: {"flowId":"6914b99017e678434634beb7","state":"initializing","timestamp":"2025-11-12T16:47:41.042Z"}
bundle.js:172419 [PaymentOrchestrator] Cleanup blocked: {"flowId":"6914b99017e678434634beb7","cleanupId":"cleanup-6914b99017e678434634beb7-1762966061041","source":"booking_details_modal","currentState":"initializing","timestamp":"2025-11-12T16:47:41.042Z"}
bundle.js:4666  Warning: Missing `Description` or `aria-describedby={undefined}` for {DialogContent}. Error Component Stack
    at DescriptionWarning (bundle.js:4657:3)
    at bundle.js:4549:5
    at bundle.js:4513:56
    at Presence (bundle.js:5084:5)
    at bundle.js:4468:62
    at div (<anonymous>)
    at bundle.js:8543:7
    at bundle.js:8508:7
    at bundle.js:8208:7
    at bundle.js:8002:16
    at Presence (bundle.js:5084:5)
    at Provider (bundle.js:4207:9)
    at DialogPortal (bundle.js:4402:5)
    at DialogPortal (bundle.js:146491:3)
    at bundle.js:146527:3
    at Provider (bundle.js:4207:9)
    at Dialog (bundle.js:4346:5)
    at BookingDetailsModal (src_components_BookingDetailsModal_js.chunk.js:660:3)
    at NotificationItemContent (src_components_NotificationItemContent_js.chunk.js:199:3)
    at div (<anonymous>)
    at MotionComponent (bundle.js:44553:59)
    at NotificationItem (src_components_NotificationCenter_js-src_services_ReviewAPI_js-node_modules_lucide-react_dist-f2e835.chunk.js:954:3)
    at ErrorBoundary (src_components_BookingDetailsModal_js.chunk.js:5423:5)
    at div (<anonymous>)
    at div (<anonymous>)
    at _c9 (bundle.js:146045:3)
    at div (<anonymous>)
    at _c (bundle.js:145989:3)
    at NotificationCenterInner (src_components_NotificationCenter_js-src_services_ReviewAPI_js-node_modules_lucide-react_dist-f2e835.chunk.js:480:3)
    at SocketProvider (bundle.js:149933:3)
    at NotificationCenter (src_components_NotificationCenter_js-src_services_ReviewAPI_js-node_modules_lucide-react_dist-f2e835.chunk.js:859:3)
    at RenderedRoute (bundle.js:118201:5)
    at Outlet (bundle.js:118848:26)
    at ProtectedRoute (src_components_ProtectedRoute_js.chunk.js:119:69)
    at RenderedRoute (bundle.js:118201:5)
    at Routes (bundle.js:118935:5)
    at Suspense (<anonymous>)
    at main (<anonymous>)
    at div (<anonymous>)
    at AppContent (bundle.js:137964:69)
    at LiveSessionProvider (bundle.js:149011:3)
    at NotificationSocketProvider (bundle.js:149838:3)
    at AppWithSocketProvider (bundle.js:138900:69)
    at AppWithSocketProviderWrapper (bundle.js:138983:69)
    at AuthProvider (bundle.js:148641:3)
    at PaymentProvider (bundle.js:149626:3)
    at Elements (bundle.js:15340:30)
    at Suspense (<anonymous>)
    at App (bundle.js:138935:51)
    at AuthProvider (bundle.js:148641:3)
    at QueryClientProvider (bundle.js:114104:21)
    at Router (bundle.js:118869:15)
    at BrowserRouter (bundle.js:116769:5)
overrideMethod @ hook.js:608
(anonymous) @ bundle.js:4666
commitHookEffectListMount @ bundle.js:103236
commitPassiveMountOnFiber @ bundle.js:104729
commitPassiveMountEffects_complete @ bundle.js:104701
commitPassiveMountEffects_begin @ bundle.js:104691
commitPassiveMountEffects @ bundle.js:104681
flushPassiveEffectsImpl @ bundle.js:106564
flushPassiveEffects @ bundle.js:106517
performSyncWorkOnRoot @ bundle.js:105734
flushSyncCallbacks @ bundle.js:93742
commitRootImpl @ bundle.js:106496
commitRoot @ bundle.js:106259
finishConcurrentRender @ bundle.js:105656
performConcurrentWorkOnRoot @ bundle.js:105507
workLoop @ bundle.js:124361
flushWork @ bundle.js:124339
performWorkUntilDeadline @ bundle.js:124576
bundle.js:172419 [PaymentPopup] Mounting with isOpen {"bookingId":"6914b99017e678434634beb7","isOpen":true,"timestamp":"2025-11-12T16:47:41.066Z"}
bundle.js:172419 [PaymentPopup] Attempting to subscribe to state. {"bookingId":"6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:41.066Z"}
bundle.js:172419 [PaymentOrchestrator] Setting up state subscription: {"requestedId":"6914b99017e678434634beb7","resolvedId":"6914b99017e678434634beb7","hasCallback":true,"timestamp":"2025-11-12T16:47:41.066Z"}
bundle.js:172419 [PaymentPopup] SUCCESS: State update received from Orchestrator. {"bookingId":"6914b99017e678434634beb7","receivedStateId":"6914b99017e678434634beb7","status":"initializing","timestamp":"2025-11-12T16:47:41.067Z"}
bundle.js:172419 [PaymentStatusService] Setting up state subscription: {"flowId":"6914b99017e678434634beb7","hasExistingState":true,"hasStateManager":true,"timestamp":"2025-11-12T16:47:41.067Z"}
bundle.js:172419 [PaymentStatusService] Subscription request: {"flowId":"6914b99017e678434634beb7","stateExists":true,"stateDetails":{"status":"initializing","version":1,"createdAt":"2025-11-12T16:47:41.010Z","lastUpdated":"2025-11-12T16:47:41.010Z","updates":[],"metadata":{"recovery":true}},"timestamp":"2025-11-12T16:47:41.067Z"}
bundle.js:172424 [DEBUG] [PaymentStatusService] No pending initialization: {"bookingId":"6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:41.067Z"}
bundle.js:172424 [DEBUG] [PaymentPopup] State updated {"bookingId":"6914b99017e678434634beb7","paymentStep":"method","modalState":"payment_active","isLoading":true,"orchestratorStateKeys":[],"timestamp":"2025-11-12T16:47:41.068Z"}
bundle.js:172419 [PaymentPopup] Unmounting with isOpen {"bookingId":"6914b99017e678434634beb7","isOpen":true,"timestamp":"2025-11-12T16:47:41.069Z"}
bundle.js:4666  Warning: Missing `Description` or `aria-describedby={undefined}` for {DialogContent}.
overrideMethod @ hook.js:608
(anonymous) @ bundle.js:4666
commitHookEffectListMount @ bundle.js:103236
invokePassiveEffectMountInDEV @ bundle.js:104925
invokeEffectsInDev @ bundle.js:106822
commitDoubleInvokeEffectsInDEV @ bundle.js:106805
flushPassiveEffectsImpl @ bundle.js:106578
flushPassiveEffects @ bundle.js:106517
performSyncWorkOnRoot @ bundle.js:105734
flushSyncCallbacks @ bundle.js:93742
commitRootImpl @ bundle.js:106496
commitRoot @ bundle.js:106259
finishConcurrentRender @ bundle.js:105656
performConcurrentWorkOnRoot @ bundle.js:105507
workLoop @ bundle.js:124361
flushWork @ bundle.js:124339
performWorkUntilDeadline @ bundle.js:124576
bundle.js:172419 [PaymentStatusService] Preparing subscription: {"flowId":"6914b99017e678434634beb7","currentState":{"status":"initializing"},"timestamp":"2025-11-12T16:47:41.077Z"}
bundle.js:172419 [StateSubscriptionManager] New subscription request: {"flowId":"6914b99017e678434634beb7","hasCallback":true,"options":{"emitCurrent":true,"initialState":{"status":"initializing","version":1,"createdAt":"2025-11-12T16:47:41.010Z","lastUpdated":"2025-11-12T16:47:41.010Z","updates":[],"metadata":{"recovery":true}}},"existingSubscribers":0,"timestamp":"2025-11-12T16:47:41.077Z"}
bundle.js:172419 [PaymentPopup] Rendering PaymentFlow with props: {"bookingId":"6914b99017e678434634beb7","amount":90,"currency":"CHF","hasClientSecret":false,"timestamp":"2025-11-12T16:47:41.090Z"}
bundle.js:172419 [PaymentFlow] Rendering with state and props: {"bookingId":"6914b99017e678434634beb7","amount":90,"currency":"CHF","orchestratorState":{"status":"initializing","keys":["id","bookingId","status","createdAt","lastUpdated","metadata","version","updates","clientSecret","flowId","lastUpdate"]},"paymentState":{"flowState":"initial"},"timestamp":"2025-11-12T16:47:41.092Z"}
bundle.js:172424 [DEBUG] [PaymentStatusIndicator] Rendering status: {"status":"initial","showLabel":true,"showDescription":false,"size":"default","timestamp":"2025-11-12T16:47:41.093Z"}
bundle.js:172419 [PaymentFlow MOUNT] Component has mounted. Checking for Stripe/Elements.
bundle.js:172419 [PaymentFlow MOUNT] SUCCESS: `stripe` and `elements` instances are available immediately.
bundle.js:172419 [PaymentFlow] Stripe and Elements are ready {"hasStripe":true,"hasElements":true,"timestamp":"2025-11-12T16:47:41.098Z"}
bundle.js:172419 [PaymentFlow] Subscribing to PaymentOrchestrator state {"bookingId":"6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:41.098Z"}
bundle.js:172419 [PaymentFlow] Received state update from Orchestrator {"bookingId":"6914b99017e678434634beb7","state":{"status":"initializing"},"timestamp":"2025-11-12T16:47:41.099Z"}
bundle.js:172419 [PaymentFlow.OrchestratorSubscription] Received state update. {"paymentFlowBookingId":"6914b99017e678434634beb7","newStateFromOrchestrator":{"flowStatus":"initializing","hasClientSecret":false,"clientSecretProvided":"NOT_PROVIDED_IN_THIS_UPDATE"},"timestamp":"2025-11-12T16:47:41.099Z"}
bundle.js:172419 [PaymentFlow] Setting up socket subscription {"bookingId":"6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:41.099Z"}
bundle.js:172424 [DEBUG] [PaymentDataService] Normalizing price data: {"input":{"base":{"amount":{"amount":90,"currency":"CHF"},"currency":"CHF"},"final":{"amount":{"amount":90,"currency":"CHF"},"currency":"CHF"},"currency":"CHF","vat":{"rate":8.1,"amount":6.74,"included":true},"platformFee":{"amount":0,"percentage":15},"discounts":[]},"inputType":"object","hasNestedStructure":true,"timestamp":"2025-11-12T16:47:41.100Z"}
bundle.js:172419 [PaymentDataService] Formatting price for payment: {"normalizedAmount":90,"currency":"CHF","hasVat":true,"hasPlatformFee":false,"timestamp":"2025-11-12T16:47:41.100Z"}
bundle.js:172419 [PaymentFlow] Unsubscribing from PaymentOrchestrator state {"bookingId":"6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:41.101Z"}
bundle.js:172419 [PaymentFlow] Cleaning up socket subscription in PaymentFlow {"bookingId":"6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:41.101Z"}
bundle.js:172424 [DEBUG] [PaymentFlow] No-op unsubscribe called for socket {"bookingId":"6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:41.101Z"}
bundle.js:172414  [PaymentSocket] Existing connection invalid, forcing reconnect: {"socketId":"smjVBwsVpVOzqHmPAAAX","timestamp":"2025-11-12T16:47:43.104Z"}
overrideMethod @ hook.js:608
warn @ bundle.js:172414
ensureConnection @ bundle.js:160463
await in ensureConnection
setupAsyncOperations @ src_components_payment_PaymentPopup_js.chunk.js:1266
(anonymous) @ src_components_payment_PaymentPopup_js.chunk.js:1321
commitHookEffectListMount @ bundle.js:103236
commitPassiveMountOnFiber @ bundle.js:104729
commitPassiveMountEffects_complete @ bundle.js:104701
commitPassiveMountEffects_begin @ bundle.js:104691
commitPassiveMountEffects @ bundle.js:104681
flushPassiveEffectsImpl @ bundle.js:106564
flushPassiveEffects @ bundle.js:106517
performSyncWorkOnRoot @ bundle.js:105734
flushSyncCallbacks @ bundle.js:93742
commitRootImpl @ bundle.js:106496
commitRoot @ bundle.js:106259
finishConcurrentRender @ bundle.js:105656
performConcurrentWorkOnRoot @ bundle.js:105507
workLoop @ bundle.js:124361
flushWork @ bundle.js:124339
performWorkUntilDeadline @ bundle.js:124576
bundle.js:172419 [PaymentSocket] Connection in progress: {"connectionId":"conn-1762966061101","attempts":0,"promise":true,"timestamp":"2025-11-12T16:47:43.106Z"}
bundle.js:172419 [PaymentAPI] Getting payment status - START: {"bookingId":"6914b99017e678434634beb7","hasBookingId":true,"type":"string","timestamp":"2025-11-12T16:47:44.010Z"}
bundle.js:172419 [PaymentAPI] Payment status response received: {"bookingId":"6914b99017e678434634beb7","responseKeys":["status","bookingId","timestamp"],"hasStatus":true,"hasPaymentIntentId":false,"timestamp":"2025-11-12T16:47:44.124Z"}
bundle.js:172419 [PaymentFlow] Socket connection ensured for PaymentFlow {"bookingId":"6914b99017e678434634beb7","connected":true,"timestamp":"2025-11-12T16:47:45.112Z"}
bundle.js:172424 [DEBUG] [PaymentSocket] Starting unique operation: {"operationKey":"subscribe:flow:6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:45.113Z"}
bundle.js:172419 [PaymentSocket] Ensuring reliable connection: {"maxAttempts":3,"timeout":5000,"context":{"operation":"flow_subscription","flowId":"6914b99017e678434634beb7"},"currentState":{"state":"connected","attempts":0,"isConnecting":false,"hasSocket":true,"isSocketConnected":true,"timestamp":"2025-11-12T16:47:45.113Z"},"timestamp":"2025-11-12T16:47:45.113Z"}
bundle.js:172419 [PaymentSocket] Operation already in progress: {"operationKey":"subscribe:flow:6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:45.114Z"}
bundle.js:172419 [SocketIO] <<< INCOMING EVENT: "ping" {"payload":[],"userId":"66f418d10a19ec0e4bbd377e","socketId":"q31dC9XIoTZH327LAAAV","timestamp":"2025-11-12T16:47:46.004Z"}
bundle.js:172424 [DEBUG] [BDM Render] BookingDetailsModal rendering. Count: 12. Reason: Internal state or context update
bundle.js:54858 i18next::translator: missingKey de bookings bookingDetailsDescription View details and manage your booking.
bundle.js:172419 [PaymentSocket] Connection established successfully: {"attempt":1,"context":{"operation":"flow_subscription","flowId":"6914b99017e678434634beb7"},"socketId":"Mar_RHItRcvybRchAAAb","timestamp":"2025-11-12T16:47:51.138Z"}
bundle.js:172419 [PaymentSocket] Restoring persistent callbacks: {"flowId":"6914b99017e678434634beb7","persistentCount":0,"timestamp":"2025-11-12T16:47:51.138Z"}
bundle.js:172424 [DEBUG] [PaymentSocket] Event name normalized: {"original":"payment_status_update","normalized":"payment_status_update","isKnownEvent":true,"timestamp":"2025-11-12T16:47:51.139Z"}
bundle.js:172424 [DEBUG] [PaymentSocket] Setting subscription state: {"flowId":"6914b99017e678434634beb7-1762966071139","state":{"flowId":"6914b99017e678434634beb7","eventName":"flow:6914b99017e678434634beb7","callbacks":{},"active":true,"startedAt":"2025-11-12T16:47:51.139Z"},"timestamp":"2025-11-12T16:47:51.139Z"}
bundle.js:172419 [PaymentSocket] Attempting room join: {"roomId":"6914b99017e678434634beb7","attempt":1,"wasConnected":true,"socketId":"Mar_RHItRcvybRchAAAb","timestamp":"2025-11-12T16:47:51.140Z"}
bundle.js:172419 [PaymentSocket] Room joined successfully: {"roomId":"6914b99017e678434634beb7","attempt":1,"socketId":"Mar_RHItRcvybRchAAAb","timestamp":"2025-11-12T16:47:51.141Z"}
bundle.js:172424 [DEBUG] [PaymentSocket] Registering flow event callback: {"flowId":"6914b99017e678434634beb7","event":"payment_status_update","timestamp":"2025-11-12T16:47:51.141Z"}
bundle.js:172424 [DEBUG] [PaymentSocket] Operation completed successfully: {"operationKey":"subscribe:flow:6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:51.141Z"}
bundle.js:172419 [useNotifications] Fetching with params: {"excludeTrash":true,"status":"all"}
bundle.js:172419 [FRONTEND-API] Making fetch request to URL: "/api/notifications?excludeTrash=true&status=all&category=&limit=50&offset=0"
bundle.js:172424 [DEBUG] [NotificationItemContent] renderActions called: {"notificationId":"6914b9a517e678434634cbe8","type":"booking_confirmed","isCoachUser":false,"bookingStatus":"confirmed","notificationStatus":"active","isActionedLocal":true}
bundle.js:172424 [DEBUG] [BDM Render] BookingDetailsModal rendering. Count: 14. Reason: Props changed: onClose, onSuggest
bundle.js:54858 i18next::translator: missingKey de bookings bookingDetailsDescription View details and manage your booking.
bundle.js:172424 [DEBUG] [BDM Render] BookingDetailsModal rendering. Count: 16. Reason: Props changed: onClose, onSuggest, existingBooking
bundle.js:54858 i18next::translator: missingKey de bookings bookingDetailsDescription View details and manage your booking.

debug: [auth] Decoded token: {"user":{"id":"66f418d10a19ec0e4bbd377e","role":"client","version":4},"iat":1762965939,"exp":1763052339} {"timestamp":"2025-11-12T16:47:37.728Z"}
info: [auth] User authenticated: 66f418d10a19ec0e4bbd377e {"timestamp":"2025-11-12T16:47:37.757Z"}
info: [recordingController.getSessionRecordings] Request received {"bookingId":"6914b99017e678434634beb7","timestamp":"2025-11-12T16:47:37.757Z","userId":"66f418d10a19ec0e4bbd377e"}
GET /api/sessions/6914b99017e678434634beb7/recordings 200 54.795 ms - 32
GET /api/bookings/public-summary/6914b99017e678434634beb7 200 161.090 ms - 3281
info: [Socket] Authentication successful {"socketId":"smjVBwsVpVOzqHmPAAAX","timestamp":"2025-11-12T16:47:38.075Z","userId":"66f418d10a19ec0e4bbd377e"}
[PaymentController] Creating payment intent {
  entityId: '6914b99017e678434634beb7',
  type: 'booking',
  userId: '66f418d10a19ec0e4bbd377e',
  timestamp: '2025-11-12T16:47:40.149Z'
}
[PaymentController] Extracting amount from: {
  priceData: { amount: { amount: 90, currency: 'CHF' }, currency: 'CHF' },
  type: 'object',
  hasAmount: true,
  defaultCurrency: 'CHF'
}
[PaymentController] Extracting amount from: {
  priceData: { amount: { amount: 90, currency: 'CHF' }, currency: 'CHF' },
  type: 'object',
  hasAmount: true,
  defaultCurrency: 'CHF'
}
[PaymentController] Amount conversion: { original: 90, rounded: 90, cents: 9000 }
[PaymentController] Amount conversion: { original: 0, rounded: 0, cents: 0 }
[PaymentController] Amount conversion: { original: 6.74, rounded: 6.74, cents: 674 }
[PaymentController] Amount conversion: { original: 90, rounded: 90, cents: 9000 }
[PaymentService.createPaymentIntent] 1. Received parameters for PI creation {
  bookingId: '6914b99017e678434634beb7',
  priceDetails: {
    base: { amount: [Object], currency: 'CHF' },
    final: { amount: [Object], currency: 'CHF' },
    vat: { rate: 8.1, amount: 6.74, included: true },
    platformFee: { amount: 0, percentage: 15 },
    currency: 'CHF',
    discounts: []
  },
  currencyArgument: 'chf',
  stripeCustomerIdArgument: 'cus_RUlp0o3z2WooA6',
  userIdArgument: '66f418d10a19ec0e4bbd377e',
  coachStripeAccountIdArgument: 'acct_1QdFtkQjpPpOYbVB',
  metadataArgumentKeys: [
    'bookingId',
    'coachId',
    'userId',
    'sessionType',
    'vatAmount',
    'vatRate',
    'platformFee',
    'originalAmount',
    'customerIpAddress'
  ],
  timestamp: '2025-11-12T16:47:40.285Z'
}
[PaymentService:createPaymentIntent] Calculated amountInCents for Stripe API {
  bookingId: '6914b99017e678434634beb7',
  finalAmountFromPriceDetails: 90,
  calculatedAmountInCents: 9000,
  timestamp: '2025-11-12T16:47:40.287Z'
}
[PaymentService:createPaymentIntent] PRE-STRIPE-API-CALL: Preparing to call stripe.paymentIntents.create {
  bookingId: '6914b99017e678434634beb7',
  amountForStripe: 9000,
  currencyForStripe: 'chf',
  customerForStripe: 'cus_RUlp0o3z2WooA6',
  applicationFeeForStripe: 674,
  destinationForStripe: 'acct_1QdFtkQjpPpOYbVB',
  metadataForStripe: {
    bookingId: '6914b99017e678434634beb7',
    platformFeeInCents: 0,
    vatAmountInCents: 674,
    coachId: '66d9cdcb0a7492a86482bd68',
    userId: '66f418d10a19ec0e4bbd377e',
    sessionType: undefined,
    vatAmount: 674,
    vatRate: 8.1,
    platformFee: 0,
    originalAmount: 9000,
    customerIpAddress: '::1'
  },
  idempotencyKey: '6914b99017e678434634beb7-1762966060288',
  timestamp: '2025-11-12T16:47:40.288Z'
}
[PaymentService.createPaymentIntent] 2. FINAL PARAMS for stripe.paymentIntents.create: {
  intentParameters: {
    amount: 9000,
    currency: 'chf',
    customer: 'cus_RUlp0o3z2WooA6',
    metadata: {
      bookingId: '6914b99017e678434634beb7',
      platformFeeInCents: 0,
      vatAmountInCents: 674,
      coachId: '66d9cdcb0a7492a86482bd68',
      userId: '66f418d10a19ec0e4bbd377e',
      sessionType: undefined,
      vatAmount: 674,
      vatRate: 8.1,
      platformFee: 0,
      originalAmount: 9000,
      customerIpAddress: '::1'
    },
    automatic_payment_methods: { enabled: true, allow_redirects: 'never' }
  }
}
[PaymentService] Payment intent created successfully {
  paymentIntentId: 'pi_3SShCoHKNqVBSHKU0rOFDQg0',
  bookingId: '6914b99017e678434634beb7',
  status: 'requires_payment_method',
  amount: 90,
  platformFeeInCents: 0,
  vatAmountInCents: 674,
  totalApplicationFeeInCents: 674,
  stripeCustomerId: 'cus_RUlp0o3z2WooA6',
  coachStripeAccountId: 'acct_1QdFtkQjpPpOYbVB',
  idempotencyKey: '6914b99017e678434634beb7-1762966060288',
  timestamp: '2025-11-12T16:47:40.947Z'
}
[Booking Model] Booking saved successfully: 6914b99017e678434634beb7
info: POST /api/payments/create-intent {"duration":"903ms","status":200,"timestamp":"2025-11-12T16:47:41.006Z","userId":"66f418d10a19ec0e4bbd377e"}
POST /api/payments/create-intent 200 900.460 ms - 178
[[[SERVER-ENTRY-POINT]]] Webhook request received at server entry. {
  method: 'POST',
  url: '/api/payments/webhook',
  headers: {
    host: 'localhost:5000',
    'user-agent': 'Stripe/1.0 (+https://stripe.com/docs/webhooks)',
    'content-length': '2595',
    accept: '*/*; q=0.5, application/xml',
    'cache-control': 'no-cache',
    'content-type': 'application/json; charset=utf-8',
    'stripe-signature': 't=1762966058,v1=29b6586f7490f039f0f830a597352b71f2740b4bf0a008912d58194ff3db1b75,v0=1cbe2bdfb270674f8270bfcbf9034ee2540000de4d11aeeffa5ed516dc6156bf',
    'accept-encoding': 'gzip'
  },
  ip: '::1'
}
[PaymentController:Webhook] RAW REQUEST RECEIVED Top of webhookHandler. Headers: {
  "host": "localhost:5000",
  "user-agent": "Stripe/1.0 (+https://stripe.com/docs/webhooks)",
  "content-length": "2595",
  "accept": "*/*; q=0.5, application/xml",
  "cache-control": "no-cache",
  "content-type": "application/json; charset=utf-8",
  "stripe-signature": "t=1762966058,v1=29b6586f7490f039f0f830a597352b71f2740b4bf0a008912d58194ff3db1b75,v0=1cbe2bdfb270674f8270bfcbf9034ee2540000de4d11aeeffa5ed516dc6156bf",
  "accept-encoding": "gzip"
}
[Webhook] Received a request from Stripe.
[PaymentController:Webhook] Stripe signature from header: t=1762966058,v1=29b6586f7490f039f0f830a597352b71f2740b4bf0a008912d58194ff3db1b75,v0=1cbe2bdfb270674f8270bfcbf9034ee2540000de4d11aeeffa5ed516dc6156bf
[PaymentController:Webhook] STRIPE_WEBHOOK_SECRET used: SET
[PaymentController:Webhook] Stripe event constructed successfully. Event Type: payment_intent.created Event ID: evt_3SShCoHKNqVBSHKU02mBbTP6
[PaymentController:Webhook] Processing event: {
  type: 'payment_intent.created',
  id: 'evt_3SShCoHKNqVBSHKU02mBbTP6',
  apiVersion: '2024-11-20.acacia',
  timestamp: '2025-11-12T16:47:41.155Z'
}
[PaymentController:Webhook] Unhandled event type: payment_intent.created
[Webhook Logging] Successfully processed and logged event: payment_intent.created (evt_3SShCoHKNqVBSHKU02mBbTP6)
[PaymentController] Fetching payment status: {
  paymentIntentId: '6914b99017e678434634beb7',
  userId: '66f418d10a19ec0e4bbd377e',
  timestamp: '2025-11-12T16:47:44.040Z'
}
[PaymentController] Payment not yet initialized for booking: {
  bookingId: new ObjectId('6914b99017e678434634beb7'),
  status: 'confirmed',
  timestamp: '2025-11-12T16:47:44.121Z'
}
[PaymentController] Fetching payment status: {
  paymentIntentId: '6914b99017e678434634beb7',
  userId: '66f418d10a19ec0e4bbd377e',
  timestamp: '2025-11-12T16:47:47.047Z'
}
[PaymentController] Payment not yet initialized for booking: {
  bookingId: new ObjectId('6914b99017e678434634beb7'),
  status: 'confirmed',
  timestamp: '2025-11-12T16:47:47.132Z'
}
[PaymentController] Fetching payment status: {
  paymentIntentId: '6914b99017e678434634beb7',
  userId: '66f418d10a19ec0e4bbd377e',
  timestamp: '2025-11-12T16:47:50.079Z'
}
[PaymentController] Payment not yet initialized for booking: {
  bookingId: new ObjectId('6914b99017e678434634beb7'),
  status: 'confirmed',
  timestamp: '2025-11-12T16:47:50.153Z'
}
[PaymentController] Fetching payment status: {
  paymentIntentId: '6914b99017e678434634beb7',
  userId: '66f418d10a19ec0e4bbd377e',
  timestamp: '2025-11-12T16:47:53.048Z'
}
[PaymentController] Payment not yet initialized for booking: {
  bookingId: new ObjectId('6914b99017e678434634beb7'),
  status: 'confirmed',
  timestamp: '2025-11-12T16:47:53.126Z'
}
[NotificationRoutes] CORRECT GET / HANDLER | Forwarding to notificationController.getNotifications. Query: {
  excludeTrash: 'true',
  status: 'all',
  category: '',
  limit: '50',
  offset: '0'
}
--- [BACKEND-CONTROLLER] GET NOTIFICATIONS (Efficient Version) ---
[Efficient] Fetching notifications for user: 66f418d10a19ec0e4bbd377e with params: {
  excludeTrash: 'true',
  status: 'all',
  category: '',
  limit: '50',
  offset: '0'
}
[Efficient] Final Mongoose Query: {"recipient":"66f418d10a19ec0e4bbd377e","status":{"$ne":"trash"}}
[Efficient] Query complete. Found 50 notifications.
GET /api/notifications?excludeTrash=true&status=all&category=&limit=50&offset=0 200 244.326 ms - 185116
[PaymentController] Fetching payment status: {
  paymentIntentId: '6914b99017e678434634beb7',
  userId: '66f418d10a19ec0e4bbd377e',
  timestamp: '2025-11-12T16:47:56.042Z'
}
[PaymentController] Payment not yet initialized for booking: {
  bookingId: new ObjectId('6914b99017e678434634beb7'),
  status: 'confirmed',
  timestamp: '2025-11-12T16:47:56.113Z'
}
[PaymentController] Fetching payment status: {
  paymentIntentId: '6914b99017e678434634beb7',
  userId: '66f418d10a19ec0e4bbd377e',
  timestamp: '2025-11-12T16:47:59.038Z'
}
[PaymentController] Payment not yet initialized for booking: {
  bookingId: new ObjectId('6914b99017e678434634beb7'),
  status: 'confirmed',
  timestamp: '2025-11-12T16:47:59.119Z'
}
[PaymentController] Fetching payment status: {
  paymentIntentId: '6914b99017e678434634beb7',
  userId: '66f418d10a19ec0e4bbd377e',
  timestamp: '2025-11-12T16:48:02.047Z'
}
[PaymentController] Payment not yet initialized for booking: {
  bookingId: new ObjectId('6914b99017e678434634beb7'),
  status: 'confirmed',
  timestamp: '2025-11-12T16:48:02.151Z'
}
[PaymentController] Fetching payment status: {
  paymentIntentId: '6914b99017e678434634beb7',
  userId: '66f418d10a19ec0e4bbd377e',
  timestamp: '2025-11-12T16:48:05.040Z'
}
[PaymentController] Payment not yet initialized for booking: {
  bookingId: new ObjectId('6914b99017e678434634beb7'),
  status: 'confirmed',
  timestamp: '2025-11-12T16:48:05.110Z'
}
debug: [auth] Decoded token: {"user":{"id":"66f418d10a19ec0e4bbd377e","role":"client","version":4},"iat":1762965939,"exp":1763052339} {"timestamp":"2025-11-12T16:48:08.013Z"}
info: [auth] User authenticated: 66f418d10a19ec0e4bbd377e {"timestamp":"2025-11-12T16:48:08.039Z"}
[PaymentController] Fetching payment status: {
  paymentIntentId: '6914b99017e678434634beb7',
  userId: '66f418d10a19ec0e4bbd377e',
  timestamp: '2025-11-12T16:48:08.039Z'
}
[PaymentController] Payment not yet initialized for booking: {
  bookingId: new ObjectId('6914b99017e678434634beb7'),
  status: 'confirmed',
  timestamp: '2025-11-12T16:48:08.135Z'
}
info: [default_disconnect_v1] Disconnect detected on DEFAULT namespace. {"event":"default_disconnect_v1","reason":"transport close","socketId":"Mar_RHItRcvybRchAAAb","timestamp":"2025-11-12T16:48:09.764Z","userId":"66f418d10a19ec0e4bbd377e"}
info: [Socket] Client disconnected {"reason":"transport close","rooms":[],"socketId":"Mar_RHItRcvybRchAAAb","timestamp":"2025-11-12T16:48:09.765Z","userId":"66f418d10a19ec0e4bbd377e"}
[UserModel] Updating user: 66f418d10a19ec0e4bbd377e
[SocketService] Broadcasting status update for user 66f418d10a19ec0e4bbd377e { status: 'offline' }
