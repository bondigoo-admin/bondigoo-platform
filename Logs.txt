[bookingController.createBooking] Function started {
  requestBody: {
    start: '2025-11-13T06:00:00.000Z',
    end: '2025-11-13T06:30:00.000Z',
    timezone: 'Europe/Zurich',
    coach: '66d9cdcb0a7492a86482bd68',
    user: '66f418d10a19ec0e4bbd377e',
    sessionType: '66ec4ea477bec414bf2b8859',
    title: 'Verf端gbarkeit',
    description: '',
    location: '',
    isOnline: false,
    userIds: [],
    availableForInstantBooking: true,
    firmBookingThreshold: 24,
    isAvailability: false,
    status: 'confirmed',
    bookingType: 'firm',
    overtime: {
      allowOvertime: false,
      freeOvertimeDuration: 0,
      paidOvertimeDuration: 0,
      overtimeRate: 0
    },
    earlyBirdDeadline: null,
    earlyBirdPrice: null,
    isRecurring: false,
    recurringPattern: 'none',
    recurringEndDate: null,
    language: null,
    tags: [],
    cancellationPolicy: null,
    isPartOfPackage: false,
    packageId: null,
    certificationOffered: false,
    certificationDetails: null,
    sessionGoal: null,
    clientNotes: null,
    preparationRequired: null,
    followUpTasks: null,
    minAttendees: null,
    maxAttendees: null,
    sessionTopic: null,
    prerequisites: null,
    learningObjectives: null,
    materialsProvided: null,
    whatToBring: null,
    skillLevel: null,
    sessionImages: [],
    courseMaterials: [],
    type: 'FIRM',
    payment: { required: true, status: 'pending' }
  },
  timestamp: '2025-11-11T19:10:35.297Z'
}
[bookingController.createBooking] Raw overtime input: {
  overtime: {
    allowOvertime: false,
    freeOvertimeDuration: 0,
    paidOvertimeDuration: 0,
    overtimeRate: 0
  },
  overtimeType: 'object',
  isObject: true,
  hasOvertime: true,
  overtimeFields: [
    'allowOvertime',
    'freeOvertimeDuration',
    'paidOvertimeDuration',
    'overtimeRate'
  ],
  timestamp: '2025-11-11T19:10:35.303Z'
}
[bookingController.createBooking] Received booking payload {
  sessionType: '66ec4ea477bec414bf2b8859',
  webinarSlots: undefined,
  bookingId: 'new',
  payloadKeys: [
    'start',
    'end',
    'timezone',
    'coach',
    'user',
    'sessionType',
    'title',
    'description',
    'location',
    'isOnline',
    'userIds',
    'availableForInstantBooking',
    'firmBookingThreshold',
    'isAvailability',
    'status',
    'bookingType',
    'overtime',
    'earlyBirdDeadline',
    'earlyBirdPrice',
    'isRecurring',
    'recurringPattern',
    'recurringEndDate',
    'language',
    'tags',
    'cancellationPolicy',
    'isPartOfPackage',
    'packageId',
    'certificationOffered',
    'certificationDetails',
    'sessionGoal',
    'clientNotes',
    'preparationRequired',
    'followUpTasks',
    'minAttendees',
    'maxAttendees',
    'sessionTopic',
    'prerequisites',
    'learningObjectives',
    'materialsProvided',
    'whatToBring',
    'skillLevel',
    'sessionImages',
    'courseMaterials',
    'type',
    'payment'
  ],
  timestamp: '2025-11-11T19:10:35.330Z'
}
[bookingController.createBooking] Fetching sessionTypeDoc {
  sessionTypeId: '66ec4ea477bec414bf2b8859',
  timestamp: '2025-11-11T19:10:35.420Z'
}
[bookingController.createBooking] Found translation for session type {
  sessionTypeId: new ObjectId('66ec4ea477bec414bf2b8859'),
  language: 'de',
  translatedName: 'Einzel',
  timestamp: '2025-11-11T19:10:35.447Z'
}
[bookingController.createBooking] Determined initial status and payment requirement: {
  determinedBookingType: 'FIRM',
  initialBookingStatus: 'pending_payment',
  paymentIsEffectivelyRequired: true,
  initialPaymentStatusOnBooking: 'pending',
  isAvailability: false,
  statusFromRequestPassedIn: 'confirmed',
  priceAmountUsedForDecision: 60,
  timestamp: '2025-11-11T19:10:35.830Z'
}
info: [bookingController.createBooking] Setting title for booking from translated session type name (or overriding generic). {"finalBookingTitle":"Einzel","originalRequestedTitleFromFrontend":"Verf端gbarkeit","sessionTypeId":"66ec4ea477bec414bf2b8859","timestamp":"2025-11-11T19:10:35.831Z","translatedSessionTypeName":"Einzel"}
[bookingController.createBooking] Processing availability slot: {
  originalSlotId: new ObjectId('691388f860639994f6bf3db3'),
  bookingStart: '2025-11-13T06:00:00.000Z',
  bookingEnd: '2025-11-13T06:30:00.000Z',
  preservedSettings: { availableForInstantBooking: true, firmBookingThreshold: 24 },
  timestamp: '2025-11-11T19:10:35.887Z'
}
[splitAvailabilitySlot] V3 START - Splitting availability slot {
  originalSlotId: new ObjectId('691388f860639994f6bf3db3'),
  originalSlotStart: 2025-11-13T05:30:00.000Z,
  originalSlotEnd: 2025-11-13T17:00:00.000Z,
  bookedStart: 2025-11-13T06:00:00.000Z,
  bookedEnd: 2025-11-13T06:30:00.000Z,
  originalOvertime: {
    allowOvertime: false,
    freeOvertimeDuration: 0,
    paidOvertimeDuration: 0,
    overtimeRate: 0,
    _id: new ObjectId('691389c160639994f6bf51c0'),
    id: '691389c160639994f6bf51c0'
  },
  originalAvailableForInstantBooking: true
}
[splitAvailabilitySlot] V3 PREPARING pre-booking slot. {
  start: 2025-11-13T05:30:00.000Z,
  end: 2025-11-13T06:00:00.000Z,
  inheritedOvertime: {
    allowOvertime: false,
    freeOvertimeDuration: 0,
    paidOvertimeDuration: 0,
    overtimeRate: 0,
    _id: new ObjectId('691389c160639994f6bf51c0')
  },
  inheritedInstantBooking: true
}
[splitAvailabilitySlot] V3 PREPARING post-booking slot. {
  start: 2025-11-13T06:30:00.000Z,
  end: 2025-11-13T17:00:00.000Z,
  inheritedOvertime: {
    allowOvertime: false,
    freeOvertimeDuration: 0,
    paidOvertimeDuration: 0,
    overtimeRate: 0,
    _id: new ObjectId('691389c160639994f6bf51c0')
  },
  inheritedInstantBooking: true
}
[splitAvailabilitySlot] V3 END - Created new slots { count: 2 }
[bookingController.createBooking] Created new availability slots: {
  count: 2,
  slots: [
    {
      start: 2025-11-13T05:30:00.000Z,
      end: 2025-11-13T06:00:00.000Z,
      preservedSettings: [Object]
    },
    {
      start: 2025-11-13T06:30:00.000Z,
      end: 2025-11-13T17:00:00.000Z,
      preservedSettings: [Object]
    }
  ],
  timestamp: '2025-11-11T19:10:35.955Z'
}
[bookingController.createBooking] Applied overtime settings {
  overtimeSettings: {
    allowOvertime: true,
    freeOvertimeDuration: 6,
    paidOvertimeDuration: 45,
    overtimeRate: 20
  },
  isAvailability: false,
  hasOvertimeInput: true,
  timestamp: '2025-11-11T19:10:35.956Z'
}
[bookingController.createBooking] Final authoritative priceDetails object before creating Booking model: {
  "base": {
    "amount": {
      "amount": 60,
      "currency": "CHF"
    },
    "currency": "CHF"
  },
  "final": {
    "amount": {
      "amount": 60,
      "currency": "CHF"
    },
    "currency": "CHF"
  },
  "netAfterDiscount": 55.5,
  "currency": "CHF",
  "discounts": [],
  "platformFee": {
    "amount": 0,
    "originalPercentage": 9.9,
    "appliedPercentage": 0
  },
  "vat": {
    "amount": 4.5,
    "rate": 8.1,
    "included": true
  },
  "estimatedStripeFee": 2.04,
  "coachReceives": 53.46,
  "_calculationDetails": {
    "baseRateSource": "Session Type Rate",
    "winningDiscount": null
  }
}
[bookingController.createBooking] Authoritative priceDetails to be saved: {
  bookingPrice: {
    base: { amount: [Object], currency: 'CHF' },
    final: { amount: [Object], currency: 'CHF' },
    netAfterDiscount: 55.5,
    currency: 'CHF',
    discounts: [],
    platformFee: { amount: 0, originalPercentage: 9.9, appliedPercentage: 0 },
    vat: { amount: 4.5, rate: 8.1, included: true },
    estimatedStripeFee: 2.04,
    coachReceives: 53.46,
    _calculationDetails: { baseRateSource: 'Session Type Rate', winningDiscount: null }
  },
  timestamp: '2025-11-11T19:10:35.958Z'
}
[bookingController.createBooking] booking.payment object BEFORE first save: {
  "status": "pending",
  "refunds": [],
  "reminderSent": []
}
[bookingController.createBooking] Booking initialized with payment: {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  payment: { status: 'pending', refunds: [], reminderSent: [] },
  sourcePayment: { required: true, status: 'pending' },
  timestamp: '2025-11-11T19:10:35.991Z'
}
[bookingController.createBooking] Payment forced before save: {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  payment: { status: 'pending' },
  sourcePayment: { required: true, status: 'pending' },
  timestamp: '2025-11-11T19:10:35.993Z'
}
[bookingController.createBooking] Booking overtime settings before save: {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  overtime: {
    allowOvertime: true,
    freeOvertimeDuration: 6,
    paidOvertimeDuration: 45,
    overtimeRate: 20,
    _id: new ObjectId('69138a2ba26ec54877c97e5c'),
    id: '69138a2ba26ec54877c97e5c'
  },
  isAvailability: false,
  timestamp: '2025-11-11T19:10:35.993Z'
}
[Booking Model] Booking saved successfully: 69138a2ba26ec54877c97e5b
[bookingController.createBooking] booking.payment object FROM DB AFTER first save: {
  "status": "pending"
}
[bookingController.createBooking] Booking saved with file metadata: {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  savedTitlePicture: [],
  savedCourseMaterialsCount: 0,
  firstSavedMaterial: null
}
[bookingController] Session link generated {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  sessionId: 'd2075ac97905da04944e490326a5685fead0463488d2357ca8607063c73a3a13',
  token: '4680c7ac...',
  timestamp: '2025-11-11T19:10:36.050Z'
}
[Booking Model] Booking saved successfully: 69138a2ba26ec54877c97e5b
[bookingController.createBooking] Booking saved: {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  price: {
    base: { amount: [Object], currency: 'CHF' },
    final: { amount: [Object], currency: 'CHF' },
    currency: 'CHF',
    vat: { rate: 8.1, amount: 4.5, included: true },
    platformFee: { amount: 0, percentage: 15 },
    discounts: []
  },
  timestamp: '2025-11-11T19:10:36.077Z'
}
[bookingController.createBooking] Starting Session handling for booking {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  bookingStatus: 'pending_payment',
  timestamp: '2025-11-11T19:10:36.078Z'
}
[bookingController.createBooking] Session.findOne completed {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  foundSession: false,
  sessionDocId: undefined,
  timestamp: '2025-11-11T19:10:36.104Z'
}
[bookingController.createBooking] Determined initial Session state for document: {
  bookingStatus: 'pending_payment',
  sessionInitialStateToSet: 'pending_payment'
}
[bookingController.createBooking] Creating new Session document {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  state: 'pending_payment',
  bookingSessionLink: {
    token: '4680c7ac459ca66530dd964a87e80ef29925ec6ae8d5aed382445cf69d20715c',
    sessionId: 'd2075ac97905da04944e490326a5685fead0463488d2357ca8607063c73a3a13',
    generatedAt: 2025-11-11T19:10:36.050Z,
    expired: false
  },
  timestamp: '2025-11-11T19:10:36.105Z'
}
[bookingController.createBooking] Session save completed successfully {
  sessionId: new ObjectId('69138a2ca26ec54877c97e61'),
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  state: 'pending_payment',
  sessionLink: undefined,
  actualEndTime: 2025-11-13T06:35:00.000Z,
  timestamp: '2025-11-11T19:10:36.132Z'
}
[bookingController.createBooking] Successfully created new Session document {
  sessionId: new ObjectId('69138a2ca26ec54877c97e61'),
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  state: 'pending_payment',
  sessionLink: undefined,
  actualEndTime: 2025-11-13T06:35:00.000Z,
  timestamp: '2025-11-11T19:10:36.133Z'
}
[PaymentService.createPaymentIntent] 1. Received parameters for PI creation {
  bookingId: '69138a2ba26ec54877c97e5b',
  priceDetails: {
    base: { amount: [Object], currency: 'CHF' },
    final: { amount: [Object], currency: 'CHF' },
    netAfterDiscount: 55.5,
    currency: 'CHF',
    discounts: [],
    platformFee: { amount: 0, originalPercentage: 9.9, appliedPercentage: 0 },
    vat: { amount: 4.5, rate: 8.1, included: true },
    estimatedStripeFee: 2.04,
    coachReceives: 53.46,
    _calculationDetails: { baseRateSource: 'Session Type Rate', winningDiscount: null }
  },
  currencyArgument: 'CHF',
  stripeCustomerIdArgument: 'cus_RUlp0o3z2WooA6',
  userIdArgument: undefined,
  coachStripeAccountIdArgument: 'acct_1QdFtkQjpPpOYbVB',
  metadataArgumentKeys: [
    'sessionType',
    'coachId',
    'userId',
    'source',
    'originalDecimalAmountFinal',
    'originalDecimalAmountBase'
  ],
  timestamp: '2025-11-11T19:10:36.135Z'
}
[PaymentService:createPaymentIntent] Calculated amountInCents for Stripe API {
  bookingId: '69138a2ba26ec54877c97e5b',
  finalAmountFromPriceDetails: 60,
  calculatedAmountInCents: 6000,
  timestamp: '2025-11-11T19:10:36.137Z'
}
[PaymentService:createPaymentIntent] PRE-STRIPE-API-CALL: Preparing to call stripe.paymentIntents.create {
  bookingId: '69138a2ba26ec54877c97e5b',
  amountForStripe: 6000,
  currencyForStripe: 'chf',
  customerForStripe: 'cus_RUlp0o3z2WooA6',
  applicationFeeForStripe: 450,
  destinationForStripe: 'acct_1QdFtkQjpPpOYbVB',
  metadataForStripe: {
    bookingId: '69138a2ba26ec54877c97e5b',
    platformFeeInCents: 0,
    vatAmountInCents: 450,
    sessionType: '1 on 1',
    coachId: '66d9cdcb0a7492a86482bd68',
    userId: '66f418d10a19ec0e4bbd377e',
    source: 'bookingController.createBooking.userPayment',
    originalDecimalAmountFinal: 60,
    originalDecimalAmountBase: 60
  },
  idempotencyKey: '69138a2ba26ec54877c97e5b-1762888236138',
  timestamp: '2025-11-11T19:10:36.138Z'
}
[PaymentService.createPaymentIntent] 2. FINAL PARAMS for stripe.paymentIntents.create: {
  intentParameters: {
    amount: 6000,
    currency: 'chf',
    customer: 'cus_RUlp0o3z2WooA6',
    metadata: {
      bookingId: '69138a2ba26ec54877c97e5b',
      platformFeeInCents: 0,
      vatAmountInCents: 450,
      sessionType: '1 on 1',
      coachId: '66d9cdcb0a7492a86482bd68',
      userId: '66f418d10a19ec0e4bbd377e',
      source: 'bookingController.createBooking.userPayment',
      originalDecimalAmountFinal: 60,
      originalDecimalAmountBase: 60
    },
    automatic_payment_methods: { enabled: true, allow_redirects: 'never' }
  }
}
[PaymentService] Payment intent created successfully {
  paymentIntentId: 'pi_3SSMxZHKNqVBSHKU0whCXnyA',
  bookingId: '69138a2ba26ec54877c97e5b',
  status: 'requires_payment_method',
  amount: 60,
  platformFeeInCents: 0,
  vatAmountInCents: 450,
  totalApplicationFeeInCents: 450,
  stripeCustomerId: 'cus_RUlp0o3z2WooA6',
  coachStripeAccountId: 'acct_1QdFtkQjpPpOYbVB',
  idempotencyKey: '69138a2ba26ec54877c97e5b-1762888236138',
  timestamp: '2025-11-11T19:10:36.648Z'
}
[bookingController.createBooking] Payment intent created: {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  paymentIntentId: 'pi_3SSMxZHKNqVBSHKU0whCXnyA',
  clientSecret: '[REDACTED]',
  amount: 60,
  currency: 'chf',
  timestamp: '2025-11-11T19:10:36.650Z'
}
[bookingController.createBooking] Payment saved: {
  paymentId: new ObjectId('69138a2ca26ec54877c97e63'),
  amount: {
    base: 60,
    platformFee: 0,
    vat: { rate: 8.1, amount: 4.5, included: true },
    total: 60,
    currency: 'CHF',
    refunded: 0
  },
  timestamp: '2025-11-11T19:10:36.678Z'
}
[bookingController.createBooking] Payment data after creation: {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  paymentId: new ObjectId('69138a2ca26ec54877c97e63'),
  paymentStatus: 'pending',
  paymentStripeClientSecret: 'pi_3SSMxZHKNqVBSHKU0whCXnyA_secret_ax6zue2K4IiaJFfUIv4l7QN4b',
  bookingPaymentStatus: 'pending',
  bookingPaymentStripeClientSecret: undefined,
  bookingType: 'FIRM',
  timestamp: '2025-11-11T19:10:36.680Z'
}
[bookingController.createBooking] Booking state before update: {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  payment: { reminderSent: [], status: 'pending', refunds: [] },
  timestamp: '2025-11-11T19:10:36.707Z'
}
[bookingController.createBooking] booking.payment object FROM DB JUST BEFORE problematic findByIdAndUpdate: {
  "status": "pending"
}
[bookingController.createBooking] Updated booking with payment details: {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  paymentStatus: 'pending',
  hasClientSecret: true,
  bookingType: 'FIRM',
  timestamp: '2025-11-11T19:10:36.758Z'
}
[bookingController.createBooking] Payment intent created and linked: {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  paymentId: new ObjectId('69138a2ca26ec54877c97e63'),
  paymentIntentId: 'pi_3SSMxZHKNqVBSHKU0whCXnyA',
  amount: 60,
  currency: 'chf',
  stripeCustomerId: 'cus_RUlp0o3z2WooA6',
  clientSecret: '[REDACTED]',
  timestamp: '2025-11-11T19:10:36.759Z'
}
[bookingController.createBooking] Populated booking: {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  price: {
    base: { amount: [Object], currency: 'CHF' },
    final: { amount: [Object], currency: 'CHF' },
    vat: { rate: 8.1, amount: 4.5, included: true },
    platformFee: { amount: 0, percentage: 15 },
    currency: 'CHF',
    discounts: []
  },
  payment: { status: 'pending', total: 60 },
  timestamp: '2025-11-11T19:10:36.844Z'
}
[bookingController.createBooking] Checking booking type for notification handling: {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  bookingType: 'FIRM',
  paymentRequired: false,
  timestamp: '2025-11-11T19:10:36.845Z'
}
[bookingController.createBooking] Skipping initial notifications for firm booking; awaiting payment confirmation: {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  paymentStatus: 'pending',
  timestamp: '2025-11-11T19:10:36.846Z'
}
[bookingController.createBooking] Booking created successfully: {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  hasPaymentIntent: true,
  priceStored: 60,
  paymentTotal: 60,
  timestamp: '2025-11-11T19:10:36.846Z'
}
POST /api/bookings 201 1586.001 ms - 4607
GET /api/bookings/66d9cdcb0a7492a86482bd68/bookings?start=2025-11-09T23:00:00.000Z&end=2025-11-16T22:59:59.999Z 200 201.063 ms - 27454
[PaymentController] Fetching payment methods: {
  userId: '66f418d10a19ec0e4bbd377e',
  authenticatedUserId: '66f418d10a19ec0e4bbd377e',
  timestamp: '2025-11-11T19:10:37.258Z'
}
[UserModel] Updating user: 66d9cdcb0a7492a86482bd68
[SocketService] Broadcasting status update for user 66d9cdcb0a7492a86482bd68 { status: 'offline' }
[PaymentController] Payment methods retrieved: { count: 2, userId: '66f418d10a19ec0e4bbd377e' }
GET /api/payments/methods/66f418d10a19ec0e4bbd377e 304 266.612 ms - -
[PaymentController] Fetching payment methods: {
  userId: '66f418d10a19ec0e4bbd377e',
  authenticatedUserId: '66f418d10a19ec0e4bbd377e',
  timestamp: '2025-11-11T19:10:37.529Z'
}
[PaymentController] Payment methods retrieved: { count: 2, userId: '66f418d10a19ec0e4bbd377e' }
GET /api/payments/methods/66f418d10a19ec0e4bbd377e 304 392.815 ms - -
[bookingRoutes] POST /api/bookings/69138a2ba26ec54877c97e5b/cancel-during-payment
[cancelBookingByUserDuringPayment] Fetched booking object state BEFORE cancellation logic. {
  bookingId: new ObjectId('69138a2ba26ec54877c97e5b'),
  metadata: {
    originalAvailability: new ObjectId('691388f860639994f6bf3db3'),
    availabilitySettings: {
      availableForInstantBooking: true,
      firmBookingThreshold: 24,
      recurringPattern: 'none'
    }
  },
  fullBookingObject: {
    payment: {
      reminderSent: [],
      status: 'pending',
      paymentRecord: new ObjectId('69138a2ca26ec54877c97e63'),
      stripe: [Object],
      refunds: []
    },
    sessionLink: {
      token: '4680c7ac459ca66530dd964a87e80ef29925ec6ae8d5aed382445cf69d20715c',
      sessionId: 'd2075ac97905da04944e490326a5685fead0463488d2357ca8607063c73a3a13',
      generatedAt: 2025-11-11T19:10:36.050Z,
      expired: false
    },
    _id: new ObjectId('69138a2ba26ec54877c97e5b'),
    coach: {
      settings: [Object],
      stripe: [Object],
      billingDetails: [Object],
      paymentPreferences: [Object],
      moderation: [Object],
      suspension: [Object],
      ltv: [Object],
      onboardingStatus: [Object],
      termsAcceptance: [Object],
      _id: new ObjectId('66d9cdcb0a7492a86482bd68'),
      firstName: 'Dominic',
      lastName: 'Frei',
      email: 'test.coach2@example.com',
      password: '$2a$10$jqGOzWaK7I7lrX4YK2Mu9.XV2eRnTqELRaQnPqjf99Hydnw6oe.LO',
      role: 'coach',
      preferredLanguage: 'de',
      availabilityStatus: 'offline',
      createdAt: 2024-09-05T15:27:07.420Z,
      __v: 20,
      status: 'offline',
      achievements: [],
      backgrounds: [Array],
      bio: '',
      interests: [],
      isActive: true,
      paymentMethods: [],
      profileVisibility: 'public',
      sessionHistory: [],
      lastStatusUpdate: 2025-11-11T19:10:37.262Z,
      coachingNeeds: [],
      customGoals: [],
      tokenVersion: 0,
      blockedByCount: 0,
      blockedUsers: [],
      isEmailVerified: false,
      trustScore: 100,
      hasActiveDispute: false,
      lastLogin: 2025-11-11T19:08:30.294Z,
      totalEnrollments: 0,
      totalSessions: 0,
      location: 'Z端rich',
      occupation: 'Kaufmann',
      phone: '+41786119931',
      flags: [Array],
      preferredLearningStyle: 'live',
      primaryGoal: [Array],
      salutation: 'mr'
    },
    user: {
      profilePicture: [Object],
      settings: [Object],
      taxInfo: [Object],
      stripe: [Object],
      billingDetails: [Object],
      paymentPreferences: [Object],
      moderation: [Object],
      suspension: [Object],
      ltv: [Object],
      onboardingStatus: [Object],
      termsAcceptance: [Object],
      _id: new ObjectId('66f418d10a19ec0e4bbd377e'),
      firstName: 'Test',
      lastName: 'User 2',
      email: 'test.user2@example.com',
      password: '$2a$10$BqYD2TyOvUF7GXQ3ePcixO3HnzsZCJRtrub0U29AcOaZkZzTvnQui',
      role: 'client',
      preferredLanguage: 'de',
      isActive: true,
      profileVisibility: 'public',
      createdAt: 2024-09-25T14:06:09.833Z,
      __v: 14,
      status: 'online',
      achievements: [],
      bio: '',
      interests: [Array],
      paymentMethods: [],
      backgrounds: [Array],
      sessionHistory: [],
      tokenVersion: 4,
      phone: '+41786116666',
      coachingNeeds: [],
      customGoals: [],
      lastStatusUpdate: 2025-11-11T19:10:15.636Z,
      location: 'Z端rich',
      occupation: 'Kaufmann',
      blockedUsers: [Array],
      blockedByCount: 0,
      isEmailVerified: false,
      lastLogin: 2025-11-11T19:10:15.415Z,
      trustScore: 100,
      hasActiveDispute: false,
      totalEnrollments: 0,
      totalSessions: 0,
      flags: [],
      primaryGoal: [],
      salutation: 'mr'
    },
    userIds: [],
    isLiveSession: false,
    sessionType: new ObjectId('66ec4ea477bec414bf2b8859'),
    start: 2025-11-13T06:00:00.000Z,
    end: 2025-11-13T06:30:00.000Z,
    timezone: 'Europe/Zurich',
    status: 'pending_payment',
    price: {
      base: [Object],
      final: [Object],
      vat: [Object],
      platformFee: [Object],
      currency: 'CHF',
      discounts: []
    },
    disputeTicket: null,
    overtime: {
      allowOvertime: true,
      freeOvertimeDuration: 6,
      paidOvertimeDuration: 45,
      overtimeRate: 20,
      _id: new ObjectId('69138a2ba26ec54877c97e5c'),
      id: '69138a2ba26ec54877c97e5c'
    },
    isAvailability: false,
    availableForInstantBooking: true,
    firmBookingThreshold: 24,
    title: 'Einzel',
    description: '',
    location: '',
    isOnline: false,
    language: null,
    tags: [],
    cancellationPolicy: {
      oneOnOne: [Object],
      webinar: [Object],
      lastUpdated: 2025-10-20T06:23:53.529Z,
      policyPreset: 'custom'
    },
    sessionGoal: null,
    clientNotes: null,
    preparationRequired: null,
    followUpTasks: null,
    minAttendees: null,
    maxAttendees: null,
    sessionTopic: null,
    prerequisites: null,
    learningObjectives: null,
    materialsProvided: null,
    whatToBring: null,
    skillLevel: null,
    webinarSlots: [],
    isPublic: true,
    showInWebinarBrowser: true,
    recurringPattern: 'none',
    recurringEndDate: null,
    earlyBirdDeadline: null,
    earlyBirdPrice: null,
    isPartOfPackage: false,
    certificationOffered: false,
    certificationDetails: null,
    bookingType: 'firm',
    reminderSent: [],
    sessionImages: [],
    courseMaterials: [],
    metadata: {
      originalAvailability: new ObjectId('691388f860639994f6bf3db3'),
      availabilitySettings: [Object]
    },
    attendees: [],
    suggestedTimes: [],
    waitlist: [],
    reminders: [],
    rescheduleHistory: [],
    rescheduleRequests: [],
    createdAt: 2025-11-11T19:10:35.998Z,
    updatedAt: 2025-11-11T19:10:36.733Z,
    __v: 0,
    recordings: Promise { [] },
    duration: 30,
    spotsRemaining: Infinity,
    id: '69138a2ba26ec54877c97e5b'
  }
}
[PaymentService] Retrieving payment intent: { paymentIntentId: 'pi_3SSMxZHKNqVBSHKU0whCXnyA' }
[PaymentService] Payment intent retrieved: {
  paymentIntentId: 'pi_3SSMxZHKNqVBSHKU0whCXnyA',
  status: 'requires_payment_method'
}
[PaymentService] Processing cancellation for PaymentIntent { paymentIntentId: 'pi_3SSMxZHKNqVBSHKU0whCXnyA', reason: 'abandoned' }
[PaymentService] Calling stripe.paymentIntents.cancel { paymentIntentId: 'pi_3SSMxZHKNqVBSHKU0whCXnyA', reason: 'abandoned' }
[PaymentService] PaymentIntent cancelled successfully via Stripe SDK { paymentIntentId: 'pi_3SSMxZHKNqVBSHKU0whCXnyA', status: 'canceled' }
[Booking Model] Booking saved successfully: 69138a2ba26ec54877c97e5b
[Booking Model] Booking saved successfully: 69138a2fa26ec54877c97eab
POST /api/bookings/69138a2ba26ec54877c97e5b/cancel-during-payment 200 710.835 ms - 60
info: [Socket] Client disconnected {"reason":"client namespace disconnect","rooms":[],"socketId":"f1rDeDBBfqFP6liMAAAH","timestamp":"2025-11-11T19:10:43.279Z","userId":"66f418d10a19ec0e4bbd377e"}
