Blueprint: Bondigoo Multi-Environment Architecture
This plan establishes a three-tier environment strategy (Production, Staging, Development) built on the core principles of isolation, security, and a streamlined Git-based workflow.
1. Environment Overview
The architecture is composed of three fully isolated environments. Each has its own dedicated infrastructure, database, and configuration.
Purpose: The live platform serving real users and customers. Processes all real financial transactions. This environment is the single source of truth for user data.
Git Branch: main
Domains:
For 1.1. Production Environment (prod):
Domains:
Frontend: https://www.bondigoo.ch
Backend: https://api.bondigoo.ch
For 1.2. Staging Environment (staging):
Domains:
Frontend: https://staging.bondigoo.ch
Backend: https://api.staging.bondigoo.ch
For 1.3. Development Environment (dev):
Domains:
Frontend: https://dev.bondigoo.ch (or Vercel preview URLs)
Backend: https://api.dev.bondigoo.ch
Service	Platform	Resource Name	Notes
Frontend App	Vercel	bondigoo-platform-prod	Vercel Project. Production Branch set to main.
Backend API	Render	bondigoo-api-prod	Web Service connected to main branch.
Job Queue Worker	Render	bondigoo-worker-prod	Background Worker connected to main branch. Processes BullMQ jobs.
Cache & Queue	Render	bondigoo-redis-prod	Managed Redis instance.
Database	MongoDB	bondigoo-prod	Dedicated production cluster. Access is highly restricted.
Purpose: A full replica of the production environment for User Acceptance Testing (UAT), final feature validation, and mass testing. It uses sanitized production data and operates in Stripe's Test Mode.

For 1.2. Staging Environment (staging):
| Service | Platform | Resource Name | Notes |
| ------------------- | -------- | --------------------------- | ------------------------------------------------------------------ |
| Frontend App | Vercel | bondigoo-platform-staging | New Vercel Project. Production Branch set to staging. |
| Backend API | Render | bondigoo-api-staging | Web Service connected to staging branch. |
| Job Queue Worker| Render | bondigoo-worker-staging | Background Worker on Free Tier. Connects to staging branch. |
| Cache & Queue | Render | bondigoo-redis-prod | Pre-launch: Shared with Production. Go-live requires dedicated bondigoo-redis-staging. |
| Database | MongoDB | bondigoo-staging | On the coaching-platform-dev cluster. Refreshed with sanitized prod data. |
For 1.3. Development Environment (dev):
| Service | Platform | Resource Name | Notes |
| ------------------- | -------- | ------------------------- | -------------------------------------------------------------------------- |
| Frontend App | Vercel | bondigoo-platform-prod | Uses Preview Deployments within the main production project. Can assign a branch domain. |
| Backend API | Render | bondigoo-api-dev | Web Service connected to develop branch. |
| Job Queue Worker| Render | bondigoo-worker-dev | Background Worker on Free Tier. Connects to develop branch. |
| Cache & Queue | Render | bondigoo-redis-prod | Pre-launch: Shared with Production. Go-live requires dedicated bondigoo-redis-dev. |
| Database | MongoDB | bondigoo-dev | On the coaching-platform-dev cluster. Managed by seed scripts. |

2. Data Management & Workflow
Production (bondigoo-prod): Sacred. Read-only access for developers. All writes are through the application API only. Backups are enabled and automated.
Staging (bondigoo-staging): Populated via a Prod-to-Staging Sync Process.
Backup: An automated or manual backup of the bondigoo-prod database is taken.
Sanitize: A dedicated script (sanitizeProdData.js, to be built) is run on the backup. This script will anonymize all PII (names, emails, addresses), scrub user-generated content, and invalidate tokens. This is a non-negotiable step for privacy compliance.
Restore: The sanitized data is restored into the bondigoo-staging database, completely overwriting it.
Development (bondigoo-dev): Managed exclusively by seed scripts. Any developer can and should be able to run npm run seed to reset the database to a known, clean state for predictable testing.
3. Third-Party Service Configuration
Isolation must extend to all external services to prevent data corruption and accidental real-world actions.
Service	Production (prod) Configuration	Staging (staging) & Development (dev) Configuration
Stripe	Live Mode keys (pk_live_..., sk_live_...). Connects to real Stripe Express accounts.	Test Mode keys (pk_test_..., sk_test_...). Uses Stripe's test data and fake Connect accounts.
Cloudinary	A dedicated Cloudinary account or sub-account for bondigoo-prod. Assets are permanent.	A separate Cloudinary account for testing. Assets can be periodically purged. This prevents test uploads from consuming production quota.
Email Service (e.g., Nodemailer backend)	Configured with production credentials (e.g., SendGrid API key) to send emails from @bondigoo.ch.	Configured with sandbox credentials. Emails should be sent only to a developer whitelist or a service like Mailtrap to avoid spamming users.
4. Required Code & Configuration Actions
To enable this architecture, the following configurations are required.
Dynamic CORS Policy:
Action: Modify server/server.js to read allowed CORS origins from a CORS_ORIGIN environment variable instead of a hardcoded array.
ENV Vars:
bondigoo-api-prod: CORS_ORIGIN=https://www.bondigoo.ch
bondigoo-api-staging: CORS_ORIGIN=https://staging.bondigoo.ch
bondigoo-api-dev: CORS_ORIGIN=https://dev.bondigoo.ch,http://localhost:3000
Frontend API URL:
Action: Ensure the REACT_APP_API_URL environment variable is set correctly in each Vercel project/environment.
ENV Vars:
Vercel Prod: REACT_APP_API_URL=https://api.bondigoo.ch
Vercel Staging: REACT_APP_API_URL=https://api.staging.bondigoo.ch
Vercel Dev Preview: REACT_APP_API_URL=https://api.dev.bondigoo.ch
Local .env file: REACT_APP_API_URL=http://localhost:5000
Launch Gate:
Action: The REACT_APP_LAUNCHED variable controls access to the full application vs. the pre-launch page.
ENV Vars:
Vercel Prod: REACT_APP_LAUNCHED=false (Change to true on launch day).
Vercel Staging: REACT_APP_LAUNCHED=true
Vercel Dev Preview: REACT_APP_LAUNCHED=true
Database URLs & Secrets:
Action: All secrets (Database URLs, API keys for Stripe/Cloudinary, etc.) must be configured as environment variables in the Render and Vercel UI for each respective service and project. They must never be committed to Git.



Here are the definitive URIs. The Staging and Development URIs are the exact ones that you are currently using. The Production URI has been built to precisely match that successful structure.
Environment	Definitive and Correct Database URL
Production	mongodb+srv://bondigoo-prod-user:<YOUR_PROD_PASSWORD>@bondigoo-prod-cluster.btsivoa.mongodb.net/bondigoo-prod?retryWrites=true&w=majority&appName=bondigoo-prod-cluster
Staging	mongodb+srv://coaching_platform_dev_user:<YOUR_DEV_PASSWORD>@coaching-platform-dev.nnaff.mongodb.net/coaching-platform-dev?retryWrites=true&w=majority&appName=coaching-platform-dev
Development	mongodb+srv://coaching_platform_dev_user:<YOUR_DEV_PASSWORD>@coaching-platform-dev.nnaff.mongodb.net/coaching-platform-dev?retryWrites=true&w=majority&appName=coaching-platform-dev